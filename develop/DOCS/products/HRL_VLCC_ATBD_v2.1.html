<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.30">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2025-06-27">
<meta name="keywords" content="Base Vegetation Layer (BVL), Temporal Convolutional Neural Network, Tree Cover Density (TCD), Dominant Leaf Type (DLT), Grassland Mowing Events (GRAME), Ploughing Indicator (PLOUGH), HR-VPP Plant Phenology Index, Transformer-based crop classification, Field-level growing season delineation, Fallow Land Presence">
<meta name="description" content="This Algorithm Theoretical Basis Document (ATBD) provides a comprehensive description of the algorithms and methodologies used to generate the High-Resolution Vegetated Land Cover Characteristics (HRL VLCC) products within the Copernicus Land Monitoring Service (CLMS). It details the processing chains for creating annual status and change layers for Tree Cover &amp; Forests, Grasslands, and Croplands at 10-meter and 20-meter resolutions, respectively. The document outlines the input data, classification techniques, post-processing steps, and confidence layers associated with each product, serving as a key resource for understanding the scientific foundation of the HRL VLCC suite and their applications in environmental monitoring and policy implementation.">

<title>High Resolution Layer Vegetated Land Cover Characteristics - Algorithm Theoretical Basis Document (ATBD) – Technical Library</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-de070a7b0ab54f8780927367ac907214.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap-da25a1371950e7b9a25e5b3e647903cc.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "ScholarlyArticle",
    "headline": "High Resolution Layer Vegetated Land Cover Characteristics - Algorithm Theoretical Basis Document (ATBD)",
    "description": "This Algorithm Theoretical Basis Document (ATBD) provides a comprehensive description of the algorithms and methodologies used to generate the High-Resolution Vegetated Land Cover Characteristics (HRL VLCC) products within the Copernicus Land Monitoring Service (CLMS). It details the processing chains for creating annual status and change layers for Tree Cover & Forests, Grasslands, and Croplands at 10-meter and 20-meter resolutions, respectively. The document outlines the input data, classification techniques, post-processing steps, and confidence layers associated with each product, serving as a key resource for understanding the scientific foundation of the HRL VLCC suite and their applications in environmental monitoring and policy implementation.",
    "datePublished": "June 27, 2025",
    "author": {
      "@type": "Person",
      "name": "?meta:author"
    },
    "publisher": {
      "@type": "Organization",
      "name": "Copernicus Land Monitoring Service",
      "logo": {
        "@type": "ImageObject",
        "url": "https://land.copernicus.eu/static/media/ccl-icon-land-text-2.e04af716.svg"
      }
    },
    "keywords": "?invalid meta type:keywords",
    "articleSection": "General",
    "isAccessibleForFree": "true",
    "license": "",
    "speakable": {
      "@type": "SpeakableSpecification",
      "cssSelector": "article p"
    }
  }
</script>

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../theme/styles.css">
</head>

<body class="nav-fixed quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Technical Library</span>
    </a>
  </div>
        <div class="quarto-navbar-tools tools-end">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Content</h2>
   
  <ul>
  <li><a href="#executive-summary" id="toc-executive-summary" class="nav-link active" data-scroll-target="#executive-summary"><span class="header-section-number">1</span> Executive summary</a></li>
  <li><a href="#background-of-the-document" id="toc-background-of-the-document" class="nav-link" data-scroll-target="#background-of-the-document"><span class="header-section-number">2</span> Background of the document</a>
  <ul class="collapse">
  <li><a href="#scope" id="toc-scope" class="nav-link" data-scroll-target="#scope"><span class="header-section-number">2.1</span> Scope</a></li>
  <li><a href="#content-and-structure" id="toc-content-and-structure" class="nav-link" data-scroll-target="#content-and-structure"><span class="header-section-number">2.2</span> Content and structure</a></li>
  </ul></li>
  <li><a href="#product-description" id="toc-product-description" class="nav-link" data-scroll-target="#product-description"><span class="header-section-number">3</span> Product Description</a>
  <ul class="collapse">
  <li><a href="#base-vegetation-layer" id="toc-base-vegetation-layer" class="nav-link" data-scroll-target="#base-vegetation-layer"><span class="header-section-number">3.1</span> Base Vegetation Layer</a>
  <ul class="collapse">
  <li><a href="#input-data" id="toc-input-data" class="nav-link" data-scroll-target="#input-data"><span class="header-section-number">3.1.1</span> Input data</a></li>
  <li><a href="#annual-classification" id="toc-annual-classification" class="nav-link" data-scroll-target="#annual-classification"><span class="header-section-number">3.1.2</span> Annual classification</a></li>
  <li><a href="#post-classification-processing" id="toc-post-classification-processing" class="nav-link" data-scroll-target="#post-classification-processing"><span class="header-section-number">3.1.3</span> Post-classification processing</a></li>
  </ul></li>
  <li><a href="#hrl-tree-cover-forests" id="toc-hrl-tree-cover-forests" class="nav-link" data-scroll-target="#hrl-tree-cover-forests"><span class="header-section-number">3.2</span> HRL Tree Cover &amp; Forests</a>
  <ul class="collapse">
  <li><a href="#tree-cover-density-tcd" id="toc-tree-cover-density-tcd" class="nav-link" data-scroll-target="#tree-cover-density-tcd"><span class="header-section-number">3.2.1</span> Tree Cover Density (TCD)</a></li>
  <li><a href="#forest-additional-support-layer-fadsl" id="toc-forest-additional-support-layer-fadsl" class="nav-link" data-scroll-target="#forest-additional-support-layer-fadsl"><span class="header-section-number">3.2.2</span> Forest Additional Support Layer (FADSL)</a></li>
  <li><a href="#forest-type-fty" id="toc-forest-type-fty" class="nav-link" data-scroll-target="#forest-type-fty"><span class="header-section-number">3.2.3</span> Forest Type (FTY)</a></li>
  <li><a href="#aggregated-products---tree-cover-density-tcd-100m-broadleaved-cover-density-bcd-coniferous-cover-density-ccd" id="toc-aggregated-products---tree-cover-density-tcd-100m-broadleaved-cover-density-bcd-coniferous-cover-density-ccd" class="nav-link" data-scroll-target="#aggregated-products---tree-cover-density-tcd-100m-broadleaved-cover-density-bcd-coniferous-cover-density-ccd"><span class="header-section-number">3.2.4</span> Aggregated products - Tree Cover Density (TCD) 100m, Broadleaved Cover Density (BCD) &amp; Coniferous Cover Density (CCD)</a></li>
  <li><a href="#aggregated-products---forest-type-fty-100m" id="toc-aggregated-products---forest-type-fty-100m" class="nav-link" data-scroll-target="#aggregated-products---forest-type-fty-100m"><span class="header-section-number">3.2.5</span> Aggregated products - Forest Type (FTY) 100m</a></li>
  <li><a href="#dominant-leaf-type-confidence-layer-dltcl" id="toc-dominant-leaf-type-confidence-layer-dltcl" class="nav-link" data-scroll-target="#dominant-leaf-type-confidence-layer-dltcl"><span class="header-section-number">3.2.6</span> Dominant Leaf Type Confidence Layer (DLTCL)</a></li>
  <li><a href="#tree-cover-density-confidence-layer-tcdcl" id="toc-tree-cover-density-confidence-layer-tcdcl" class="nav-link" data-scroll-target="#tree-cover-density-confidence-layer-tcdcl"><span class="header-section-number">3.2.7</span> Tree Cover Density Confidence Layer (TCDCL)</a></li>
  <li><a href="#tree-cover-presence-change-confidence-layer-tcpccl" id="toc-tree-cover-presence-change-confidence-layer-tcpccl" class="nav-link" data-scroll-target="#tree-cover-presence-change-confidence-layer-tcpccl"><span class="header-section-number">3.2.8</span> Tree Cover Presence Change Confidence Layer (TCPCCL)</a></li>
  <li><a href="#encountered-issues-and-known-limitations" id="toc-encountered-issues-and-known-limitations" class="nav-link" data-scroll-target="#encountered-issues-and-known-limitations"><span class="header-section-number">3.2.9</span> Encountered issues and known limitations</a></li>
  </ul></li>
  <li><a href="#hrl-grasslands-status-and-change-layers" id="toc-hrl-grasslands-status-and-change-layers" class="nav-link" data-scroll-target="#hrl-grasslands-status-and-change-layers"><span class="header-section-number">3.3</span> HRL Grasslands status and change layers</a>
  <ul class="collapse">
  <li><a href="#input-data-1" id="toc-input-data-1" class="nav-link" data-scroll-target="#input-data-1"><span class="header-section-number">3.3.1</span> Input data</a></li>
  <li><a href="#sec-Herbaceous-Cover" id="toc-sec-Herbaceous-Cover" class="nav-link" data-scroll-target="#sec-Herbaceous-Cover"><span class="header-section-number">3.3.2</span> Herbaceous Cover (HER)</a></li>
  <li><a href="#ploughing-indicator-plough" id="toc-ploughing-indicator-plough" class="nav-link" data-scroll-target="#ploughing-indicator-plough"><span class="header-section-number">3.3.3</span> Ploughing Indicator (PLOUGH)</a></li>
  <li><a href="#grassland-gra" id="toc-grassland-gra" class="nav-link" data-scroll-target="#grassland-gra"><span class="header-section-number">3.3.4</span> Grassland (GRA)</a></li>
  <li><a href="#grassland-confidence-gracl" id="toc-grassland-confidence-gracl" class="nav-link" data-scroll-target="#grassland-confidence-gracl"><span class="header-section-number">3.3.5</span> Grassland Confidence (GRACL)</a></li>
  <li><a href="#sec-GRAC" id="toc-sec-GRAC" class="nav-link" data-scroll-target="#sec-GRAC"><span class="header-section-number">3.3.6</span> Grassland Change (GRAC)</a></li>
  <li><a href="#grassland-change-confidence-layer-graccl" id="toc-grassland-change-confidence-layer-graccl" class="nav-link" data-scroll-target="#grassland-change-confidence-layer-graccl"><span class="header-section-number">3.3.7</span> Grassland Change Confidence Layer (GRACCL)</a></li>
  <li><a href="#aggregated-products-grassland-gra100m" id="toc-aggregated-products-grassland-gra100m" class="nav-link" data-scroll-target="#aggregated-products-grassland-gra100m"><span class="header-section-number">3.3.8</span> Aggregated products – Grassland (GRA)100m</a></li>
  <li><a href="#encountered-issues-and-known-limitations-1" id="toc-encountered-issues-and-known-limitations-1" class="nav-link" data-scroll-target="#encountered-issues-and-known-limitations-1"><span class="header-section-number">3.3.9</span> Encountered issues and known limitations</a></li>
  </ul></li>
  <li><a href="#hrl-grasslands-mowing-layers" id="toc-hrl-grasslands-mowing-layers" class="nav-link" data-scroll-target="#hrl-grasslands-mowing-layers"><span class="header-section-number">3.4</span> HRL Grasslands mowing layers</a>
  <ul class="collapse">
  <li><a href="#input-data-2" id="toc-input-data-2" class="nav-link" data-scroll-target="#input-data-2"><span class="header-section-number">3.4.1</span> Input data</a></li>
  <li><a href="#grassland-mowing-dates-gramd" id="toc-grassland-mowing-dates-gramd" class="nav-link" data-scroll-target="#grassland-mowing-dates-gramd"><span class="header-section-number">3.4.2</span> Grassland Mowing Dates (GRAMD)</a></li>
  <li><a href="#grassland-mowing-events-grame" id="toc-grassland-mowing-events-grame" class="nav-link" data-scroll-target="#grassland-mowing-events-grame"><span class="header-section-number">3.4.3</span> Grassland Mowing Events (GRAME)</a></li>
  <li><a href="#grassland-mowing-event-confidence-layer-gramecl" id="toc-grassland-mowing-event-confidence-layer-gramecl" class="nav-link" data-scroll-target="#grassland-mowing-event-confidence-layer-gramecl"><span class="header-section-number">3.4.4</span> Grassland Mowing Event Confidence Layer (GRAMECL)</a></li>
  <li><a href="#sec-Encountered-issues-and-known-limitations" id="toc-sec-Encountered-issues-and-known-limitations" class="nav-link" data-scroll-target="#sec-Encountered-issues-and-known-limitations"><span class="header-section-number">3.4.5</span> Encountered issues and known limitations</a></li>
  </ul></li>
  <li><a href="#hrl-crop-type" id="toc-hrl-crop-type" class="nav-link" data-scroll-target="#hrl-crop-type"><span class="header-section-number">3.5</span> HRL Crop Type</a>
  <ul class="collapse">
  <li><a href="#input-data-3" id="toc-input-data-3" class="nav-link" data-scroll-target="#input-data-3"><span class="header-section-number">3.5.1</span> Input data</a></li>
  <li><a href="#classification-algorithm-and-inference" id="toc-classification-algorithm-and-inference" class="nav-link" data-scroll-target="#classification-algorithm-and-inference"><span class="header-section-number">3.5.2</span> Classification algorithm and inference</a></li>
  <li><a href="#post-processing" id="toc-post-processing" class="nav-link" data-scroll-target="#post-processing"><span class="header-section-number">3.5.3</span> Post-processing</a></li>
  <li><a href="#crop-type-confidence-layer" id="toc-crop-type-confidence-layer" class="nav-link" data-scroll-target="#crop-type-confidence-layer"><span class="header-section-number">3.5.4</span> Crop Type Confidence Layer</a></li>
  <li><a href="#encountered-issues-and-know-limitations" id="toc-encountered-issues-and-know-limitations" class="nav-link" data-scroll-target="#encountered-issues-and-know-limitations"><span class="header-section-number">3.5.5</span> Encountered issues and know limitations</a></li>
  </ul></li>
  <li><a href="#hrl-cropping-pattern" id="toc-hrl-cropping-pattern" class="nav-link" data-scroll-target="#hrl-cropping-pattern"><span class="header-section-number">3.6</span> HRL Cropping Pattern</a>
  <ul class="collapse">
  <li><a href="#input-data-4" id="toc-input-data-4" class="nav-link" data-scroll-target="#input-data-4"><span class="header-section-number">3.6.1</span> Input data</a></li>
  <li><a href="#product-structure" id="toc-product-structure" class="nav-link" data-scroll-target="#product-structure"><span class="header-section-number">3.6.2</span> Product structure</a></li>
  <li><a href="#growing-season-delineation" id="toc-growing-season-delineation" class="nav-link" data-scroll-target="#growing-season-delineation"><span class="header-section-number">3.6.3</span> Growing season delineation</a></li>
  <li><a href="#confidence-layers" id="toc-confidence-layers" class="nav-link" data-scroll-target="#confidence-layers"><span class="header-section-number">3.6.4</span> Confidence layers</a></li>
  <li><a href="#derivation-of-main-crops-bare-soil-secondary-crops-fallow-land-and-cropping-seasons-layers" id="toc-derivation-of-main-crops-bare-soil-secondary-crops-fallow-land-and-cropping-seasons-layers" class="nav-link" data-scroll-target="#derivation-of-main-crops-bare-soil-secondary-crops-fallow-land-and-cropping-seasons-layers"><span class="header-section-number">3.6.5</span> Derivation of Main Crops, Bare Soil, Secondary Crops, Fallow Land and Cropping Seasons layers</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#list-of-abbreviations" id="toc-list-of-abbreviations" class="nav-link" data-scroll-target="#list-of-abbreviations"><span class="header-section-number">4</span> List of abbreviations</a></li>
  <li><a href="#references" id="toc-references" class="nav-link" data-scroll-target="#references"><span class="header-section-number">5</span> References</a></li>
  <li><a href="#annex-i---aggregation-rules-for-20m-layers-tcpc-dltc-and-grac" id="toc-annex-i---aggregation-rules-for-20m-layers-tcpc-dltc-and-grac" class="nav-link" data-scroll-target="#annex-i---aggregation-rules-for-20m-layers-tcpc-dltc-and-grac"><span class="header-section-number">6</span> Annex I - Aggregation rules for 20m layers TCPC, DLTC and GRAC</a></li>
  <li><a href="#annex-ii-tcpc-mmu-filtering" id="toc-annex-ii-tcpc-mmu-filtering" class="nav-link" data-scroll-target="#annex-ii-tcpc-mmu-filtering"><span class="header-section-number">7</span> Annex II TCPC MMU filtering</a></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="HRL_VLCC_ATBD_v2.1.docx"><i class="bi bi-file-word"></i>MS Word</a></li><li><a href="HRL_VLCC_ATBD_v2.1.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">
<script>
  document.addEventListener("DOMContentLoaded", function () {
    // Remove link to .docx file
    //
    document.querySelectorAll("a[href$='.docx']").forEach((link) => (link.style.display = "none"));

    // Add Version to the title's metadata
    //
    const titleMetaEl = document.querySelector(".quarto-title-meta");
    const wrapperDiv = document.createElement("div");
    wrapperDiv.innerHTML = `
        <div class="quarto-title-meta-heading">Version</div>
        <div class="quarto-title-meta-contents">
          <p>2.1</p>
        </div>
      `;
    titleMetaEl.appendChild(wrapperDiv);
  });
</script>

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">High Resolution Layer Vegetated Land Cover Characteristics - Algorithm Theoretical Basis Document (ATBD)</h1>
<p class="subtitle lead">Copernicus Land Monitoring Service</p>
</div>

<div>
  <div class="description">
    This Algorithm Theoretical Basis Document (ATBD) provides a comprehensive description of the algorithms and methodologies used to generate the High-Resolution Vegetated Land Cover Characteristics (HRL VLCC) products within the Copernicus Land Monitoring Service (CLMS). It details the processing chains for creating annual status and change layers for Tree Cover &amp; Forests, Grasslands, and Croplands at 10-meter and 20-meter resolutions, respectively. The document outlines the input data, classification techniques, post-processing steps, and confidence layers associated with each product, serving as a key resource for understanding the scientific foundation of the HRL VLCC suite and their applications in environmental monitoring and policy implementation.
  </div>
</div>


<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 27, 2025</p>
    </div>
  </div>
  
    
  </div>
  

<div>
  <div class="keywords">
    <div class="block-title">Keywords</div>
    <p>Base Vegetation Layer (BVL), Temporal Convolutional Neural Network, Tree Cover Density (TCD), Dominant Leaf Type (DLT), Grassland Mowing Events (GRAME), Ploughing Indicator (PLOUGH), HR-VPP Plant Phenology Index, Transformer-based crop classification, Field-level growing season delineation, Fallow Land Presence</p>
  </div>
</div>

</header>


<div data-custom-style="LeftAlign">
<p>European Environment Agency (EEA)<br>
Kongens Nytorv 6<br>
1050 Copenhagen K<br>
Denmark<br>
<a href="https://land.copernicus.eu/"><strong>https://land.copernicus.eu/</strong></a></p>
</div>
<div style="page-break-after: always;"></div>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"ItemList","itemListElement":[{"@type":"ImageObject","caption":"Figure  1:  High-level  flow  chart  of  the  BVL  workflow  and  its  usage  by  the  downstream  processors  for  Tree  Cover  &  Forests,  Grasslands  and  Croplands.","url":"HRL_VLCC_ATBD_v2.1-media/img-676c43b68eec6fd5be8bccbd542e4bc1c38175e2.png"},{"@type":"ImageObject","caption":"Figure  2:  Production  units  subdividing  the  EEA-38  area  into  homogenous  biogeographical  substrata  for  the  production  of  the  BVL  (GF:  French  Guiana,  GP:  Guadeloupe,  MQ:  Martinique,  RE:  Le  Réunion,  YT:  Mayotte).","url":"HRL_VLCC_ATBD_v2.1-media/img-96d4f7ffe37f4b6d5ba2b5ac9886614e2b0e3258.png"},{"@type":"ImageObject","caption":"Figure  3:  High-level  flow  chart  of  the  production  workflow  for  the  Tree  Cover  &  Forests  products  TCD,  DLT,  TCPC  and  DLTC.","url":"HRL_VLCC_ATBD_v2.1-media/img-8c75bc7b81f884492f16d2dc812579fecc761de9.png"},{"@type":"ImageObject","caption":"Figure  4:  High-level  flow  chart  of  the  production  workflow  for  the  Tree  Cover  &  Forests  products  FADSL,  FTY  and  aggregated  products  at  100m.","url":"HRL_VLCC_ATBD_v2.1-media/img-ca3af50470b86f297c48a5a7e3b6625919df0077.png"},{"@type":"ImageObject","caption":"Figure  5:  Dominant  Leaf  Type  for  the  reference  year  2021  a)  after  initial  classification  and  b)  after  reprocessing  for  agroforestry  system  in  Andalusia,  Spain  (LAEA  3044254.4m,  1822153.02m)  Background  Google  Maps  VHR  imagery  03/2021.","url":"HRL_VLCC_ATBD_v2.1-media/img-76519c7ec6c010f538a443731db40973837bf1f3.png","width":"70%"},{"@type":"ImageObject","caption":"Figure  6:  Example  for  an  area  with  imprints  of  topographic  effects  into  the  Tree  Cover  Density  layer  in  Northern  Norway  (LAEA.  4833337.67m,  5288588.26m)  a)  VHR  image  07/2021  (Google  Maps)  b)  final  TCD  layer  for  2021  and  c)  median  of  S-2  L2A  band  3  over  the  vegetation  season.","url":"HRL_VLCC_ATBD_v2.1-media/img-bc1b609dee87f1e9ffa5ba0bf47c2f4e63f371a2.png","width":"70%"},{"@type":"ImageObject","caption":"Figure  7:  Example  for  initial  TCD  underestimation  due  to  proportional  high  number  of  early  spring  scenes  with  trees  in  leaf-off  conditions  in  Northern  Germany  (LAEA,  4186992.95m  3368117.83m).  a)  initial  (unmasked)  TCD  estimates  using  median  features  for  March  –  October  2021  and  showing  severe  underestimation  for  broadleaved  deciduous  canopies,  b)  VHR  image  2021  and  c)  final  TCD  based  on  reduced  time  window  from  May  to  September  2021  and  percentile  features.","url":"HRL_VLCC_ATBD_v2.1-media/img-2dd3407d3fdf8a7517f3847a38faefdfec124e4d.png"},{"@type":"ImageObject","caption":"Figure  8:  Flowchart  of  the  PLOUGH  decision  logic","url":"HRL_VLCC_ATBD_v2.1-media/img-da90c1314ea785b85e939102f3c1d3f6e81a9387.png"},{"@type":"ImageObject","caption":"Figure  9:  Comparison  of  GRAC  layers  from  test  production  and  current  production  taken  from  EEA  tile  E39N31  (upper  example  in  the  centre  around  (3957750,  3114334),  lower  example  in  the  centre  around  (3984094,  3150073).  Blue  areas  indicate  grassland  gain,  red  areas  indicate  grassland  loss  (for  year  2018  to  2021).","url":"HRL_VLCC_ATBD_v2.1-media/img-8719e7bd2267f1c5464a04d53f8f28dfc13d0098.png"},{"@type":"ImageObject","caption":"Figure  10:  EEA  tile  E35N25.  On  the  left  side  PLOUGH  2015  in  20  m  and  on  the  right  side,  the  PLOUGH  2017-2021.  The  orange  (left)  and  the  yellow  (right)  patch  in  the  centre  of  the  figures  comes  from  the  HIST-PLOUGH  and  therefore  shows  the  outline  of  the  20  m  pixel  size  at  that  time.","url":"HRL_VLCC_ATBD_v2.1-media/img-1361d85aaefb1873757c904fc85aa2aa2698f10a.png"},{"@type":"ImageObject","caption":"Figure  11:  Colour  palette  and  attributes  of  PLOUGH  layer.  Left:  HRL  GRA  2015/2018  and  right  HRL  VLCC.","url":"HRL_VLCC_ATBD_v2.1-media/img-b47d1af3225b944dbe9e4f0eab771936c27a02f9.png"},{"@type":"ImageObject","caption":"Figure  12:  Single-pixel  NDVI  time  series  and  mowing  events  (ground  truth  and  detected)  for  2021  (32TPT;  WGS84  coordinates:  11.3151°E,  47.5911°N).","url":"HRL_VLCC_ATBD_v2.1-media/img-9a30382a1e822f8c20aba634c1b8b5fe39893347.png"},{"@type":"ImageObject","caption":"Figure  13:  Single-pixel  NDVI  time  series  and  mowing  events  (ground  truth  and  detected)  for  2021  (32TPT;  WGS84  coordinates:  11.3103°E,  47.5884°N).","url":"HRL_VLCC_ATBD_v2.1-media/img-6beb035041b6456fa36fcdababaf84705f920bdf.png"},{"@type":"ImageObject","caption":"Figure  14:  Processing  workflow  and  pipeline  for  the  GRAMD  and  GRAME  layers  part  1:  Source  data  selection,  pre-processing  and  cloud  masking,  and  mowing  event  detection.","url":"HRL_VLCC_ATBD_v2.1-media/img-e3e2e358e2935abec94b3406f1fbcc86ad73801c.png"},{"@type":"ImageObject","caption":"Figure  15:  Processing  workflow  and  pipeline  for  the  GRAMD  and  GRAME  layers:  reprojection,  shift  to  yearly  timeframes,  mosaic,  MMU  filtering  and  data  export.","url":"HRL_VLCC_ATBD_v2.1-media/img-303adab12940a2f66fe85851323e4e84adb79614.png","width":"50%"},{"@type":"ImageObject","caption":"Figure  16:  Sentinel-2A  and  -  2B  L1C  data  coverage  in  2018.  Shown  are  (a)  average  cloudiness,  and  (b)  average  gap  between  cloud-free  observations.","url":"HRL_VLCC_ATBD_v2.1-media/img-cc948934135584de49fbd4cb942740dcde2e9c17.png"},{"@type":"ImageObject","caption":"Figure  17:  Visibility  of  the  Sentinel-2  swath  borders  and  the  different  swath  coverage  in  the  GRAME  layer  (32TPT;  WGS84  coordinates:  10.63480°E,  47.65318°N).","url":"HRL_VLCC_ATBD_v2.1-media/img-321da7a884def72c625e69183efbbe9654e38607.png"},{"@type":"ImageObject","caption":"Figure  18:  Schematic  overview  of  the  crop  type  model  architecture","url":"HRL_VLCC_ATBD_v2.1-media/img-30f252232ca825a8c65e2f9d4607446160de7470.png"},{"@type":"ImageObject","caption":"Figure  19:  CTY  postprocessing  pipeline  flowchart","url":"HRL_VLCC_ATBD_v2.1-media/img-78c38c35d79557f1150fa0e6918cd84024ca4f22.png"},{"@type":"ImageObject","caption":"Figure  20:  Decision  tree  of  the  CTY  postprocessing  pipeline,  outlining  the  main  steps  from  raw  crop  type  probabilities  to  final  output  classes.  For  clarity,  output  categories  are  simplified  to   and   cropland,  as  the  decision  rules  were  specifically  designed  for  these  classes.  Note  that  spatial  operations  (defined  in  Figure  19)  such  as  spatial  smoothing  and  GDAL  Sieve,  although  they  may  further  modify  crop  type  labels,  are  not  included  in  this  diagram  to  maintain  readability","url":"HRL_VLCC_ATBD_v2.1-media/img-b752ff52dd8f50223ebe874203e33a0c3406029f.png","width":"50%"},{"@type":"ImageObject","caption":"Figure  21:  Schematic  overview  of  cropping  pattern  products  generation.","url":"HRL_VLCC_ATBD_v2.1-media/img-5aebd0eb11363c76ebc7b03745474b57189972ca.png"},{"@type":"ImageObject","caption":"Figure  22:  Schematic  overview  of  the  growing  season  delineation.","url":"HRL_VLCC_ATBD_v2.1-media/img-7ada907705c4edf3e61d95d290fbdd4b8e17b4df.png"},{"@type":"ImageObject","caption":"Figure  23:  Different  parameters  selected  for  detecting  an  emergence  event  out  of  a  seasonal  profile.","url":"HRL_VLCC_ATBD_v2.1-media/img-0b015b66e7689d69b6db9b63a616bcca4a767ec0.png"},{"@type":"ImageObject","caption":"Figure  24:  Schematic  overview  on  the  parameters  used  to  calculate  the  uncertainty  at  an  event  data  (i.e.,  emergence  or  harvest).  Event  date  is  in  this  example,  an  emergence.","url":"HRL_VLCC_ATBD_v2.1-media/img-23efa437cf45423915c018c5bdcd16023b7c710b.png"},{"@type":"ImageObject","caption":"Figure  25:  Workflow  for  fallow  land  presence  classification.  With  CP:  cropping  pattern,  CTYCL:  confidence  value  of  CTY  layer.  For  the  Metzger  based  environmental  zonation  see  Table  5.","url":"HRL_VLCC_ATBD_v2.1-media/img-2e78c63221247c54d2de67164438c015ea8c8e30.png"},{"@type":"ImageObject","caption":"Figure  26:  Example  of  CropSAR  fAPAR  signal  for  a  sunflower  field  in  southern  Spain  in  2019.  The  black  lines  show  the  detected  emergence  dates  within  the  time  series.","url":"HRL_VLCC_ATBD_v2.1-media/img-a014c53b4082d3774a361ab4665f133ec588819a.png"},{"@type":"ImageObject","caption":"","url":"HRL_VLCC_ATBD_v2.1-media/img1.png"},{"@type":"ImageObject","caption":"","url":"HRL_VLCC_ATBD_v2.1-media/img2.png"},{"@type":"ImageObject","caption":"","url":"HRL_VLCC_ATBD_v2.1-media/img3.png"},{"@type":"ImageObject","caption":"","url":"HRL_VLCC_ATBD_v2.1-media/img4.png"},{"@type":"ImageObject","caption":"","url":"HRL_VLCC_ATBD_v2.1-media/img5.png"}]}
</script>
<section id="executive-summary" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Executive summary</h1>
<p>Copernicus is the European Union’s Earth Observation Programme. It offers information services based on satellite Earth observation and in situ (non-space) data. These information services are freely and openly accessible to its users through six thematic Copernicus services (Atmosphere Monitoring, Marine Environment Monitoring, Land Monitoring, Climate Change, Emergency Management and Security).</p>
<p>The Copernicus Land Monitoring Service (CLMS) is jointly implemented by the European Environment Agency and the European Commission’s DG Joint Research Centre (JRC) and provides geographical information on land cover and its changes, land use, vegetation state, water cycle and earth surface energy variables to a broad range of users in Europe and across the world in the field of environmental terrestrial applications. Within this service, the HighResolution Vegetated Land Cover Characteristics (HRL VLCC) product suite provides detailed annual maps and change layers for Tree Cover &amp; Forests, Grasslands, and Croplands at resolutions of 10 meters (status layers) and 20 meters (change layers). The High-Resolution Vegetated Land Cover Characteristics products extend the time-series of the existing HRLs Forest and Grassland and complements the CLMS portfolio with new layer dedicated to the mapping of Crop Types and Agricultural practices such as mowing, harvest and cover crops.</p>
<p>The HRL VLCC products leverage advanced algorithms and multi-source satellite data, including Sentinel-2 imagery, to ensure high thematic accuracy. Key innovations include the Base Vegetation Layer (BVL), which harmonizes classifications across land cover types, and new agricultural monitoring capabilities such as crop type identification, ploughing indicators, and grassland mowing event detection. Complementary confidence layers quantify classification reliability for enhanced decision-making.</p>
<p>This document serves as a critical resource for understanding the scientific rigor behind HRL VLCC products, enabling their effective application in biodiversity conservation, agricultural monitoring, climate change adaptation, and compliance with EU policies such as the Common Agricultural Policy (CAP) and LULUCF regulation.</p>
</section>
<section id="background-of-the-document" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> Background of the document</h1>
<section id="scope" class="level2" data-number="2.1">
<h2 data-number="2.1" class="anchored" data-anchor-id="scope"><span class="header-section-number">2.1</span> Scope</h2>
<p>The Algorithm Theoretical Basis Document (ATBD) for the High-Resolution Vegetated Land Cover Characteristics (HRL VLCC) offers a comprehensive overview of the methodologies, algorithms, and workflows underpinning the generation of the HRL VLCC products.</p>
</section>
<section id="content-and-structure" class="level2" data-number="2.2">
<h2 data-number="2.2" class="anchored" data-anchor-id="content-and-structure"><span class="header-section-number">2.2</span> Content and structure</h2>
<p>In more detail, the document is structured as follows:</p>
<ul>
<li><p>Chapter 1 contains the executive summary of the project together with a general information about European Union’s Earth Observation Programme and Copernicus Land Monitoring Service (CLMS),</p></li>
<li><p>Chapter 2 details the scope, content and structure of this document with a list of applicable documents,</p></li>
<li><p>Chapter 3 describes the general thematic content and product descriptions with the methodology and workflows,</p></li>
<li><p>and the References and Annex Chapters list references to the cited literature and documents.</p></li>
</ul>
</section>
</section>
<section id="product-description" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Product Description</h1>
<section id="base-vegetation-layer" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="base-vegetation-layer"><span class="header-section-number">3.1</span> Base Vegetation Layer</h2>
<p>The Base Vegetation Layer (BVL) is an internal processing layer to ensure better base consistency between the VLCC product groups Croplands, Grasslands and Tree Cover &amp; Forests. The BVL provides a gap-free yearly mapping of the areas with tree cover and cropland and/or grassland. It also classifies a background class which comprises non-vegetated areas (e.g.&nbsp;bare ground, urban areas, water), lichens and mosses as well as shrubs (as long as not for agriculture such as vineyards). This section details the applied methods for the production of the BVL. An overview of the workflow is provided in Figure 1.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-676c43b68eec6fd5be8bccbd542e4bc1c38175e2.png" class="img-fluid figure-img"></p>
<figcaption>Figure 1: High-level flow chart of the BVL workflow and its usage by the downstream processors for Tree Cover &amp; Forests, Grasslands and Croplands.</figcaption>
</figure>
</div>
<section id="input-data" class="level3" data-number="3.1.1">
<h3 data-number="3.1.1" class="anchored" data-anchor-id="input-data"><span class="header-section-number">3.1.1</span> Input data</h3>
<p>The main input data sources for the BVL are Sentinel-2 time-series covering the period for a respective reference years ± 3 months (e.g.&nbsp;for 2018 observations from 2016-10-01 till 2019-03-31 are considered). Initially the Scene Classification Layers (SCL) for all available S-2 L2A products and with a cloud coverage lower than 80% are retrieved and a time-series is constructed using the best (i.e.&nbsp;lowest cloud cover) scenes within a given spatio-temporal window. Typically,windows of 15 days and 20x20km are used, for parts of Scandinavia this has been augmented to 5 days and 10x10km to reduce the impact of frequent cloud cover.</p>
<p>The training / validation and test data required for the model calibration are compiled from various sources, such as from adjusted and filtered LUCAS (Eurostat, 2018) data of 2018, from stratified automated land cover (LC) class annotations based on existing land use/land cover maps, such as the CORINE Land Cover (CLC) 2018 and HRL Imperviousness 2018. Those are complemented with additional visual sample point photo-interpretation from Very High Resolution (VHR) imagery, Normalised Difference Vegetation Index (NDVI) time series and auxiliary datasets.</p>
<p>The initial training dataset comprises approximately 1.1 Million training points which are subjected to routines for detecting tree cover losses (based on NDVI time-series) as well as erroneous annotations and outliers related to general land cover changes (Cleanlab, Northcutt et al., 2021). Additional sampling is performed during the production on an ad hoc basis for particularly difficult areas.</p>
</section>
<section id="annual-classification" class="level3" data-number="3.1.2">
<h3 data-number="3.1.2" class="anchored" data-anchor-id="annual-classification"><span class="header-section-number">3.1.2</span> Annual classification</h3>
<p>Given the heterogeneity of the addressed European landscapes, all classifier training, testing and, finally, LC classification, is performed along substrata based on biogeographical regions (Metzger et al.&nbsp;2013) and existing LC layers. The AOI is subdivided in 232 of these substrata which form the Production Units (PUs) (Figure 2). The goal of this stratification is to facilitate the fitting of the models to the regional specificities and thereby achieve a higher accuracy. The model architecture is a Temporal Convolutional Neural Network (TempCNN, Pelletier et al.&nbsp;2019) which is trained with labels and filtered time-series (see section Input Data) of five reference years in the respective PU and a buffer area of 10km. Inference is performed on yearly time-series for the target reference year ± 3 months and outputs yearly probabilities for the 6 basic land cover classes:</p>
<ol type="1">
<li><p>herbaceous vegetation;</p></li>
<li><p>tree cover-broadleaved;</p></li>
<li><p>tree cover-coniferous</p></li>
<li><p>cropland;</p></li>
<li><p>tree crops (i.e.&nbsp;nomenclature overlap between broadleaved tree cover and permanent crops in the HRL Croplands product);</p></li>
<li><p>background class (including bare and sparsely vegetated areas and non-agricultural shrubs);</p></li>
</ol>
<p>In a subsequent post-processing step two further classes are derived to delineate the:</p>
<ol start="7" type="1">
<li><p>potential overlap herbaceous – cropland (i.e.&nbsp;pixels which are classified as cropland and herbaceous at least once in the time-series);</p></li>
<li><p>The second derived class is derived from the intersection of all areas classified as tree cover and a preliminary version of the Tree Cover Density to delineate areas with low Tree Cover Density and hence allowed overlaps of herbaceous and tree cover.</p></li>
</ol>
<p>The resulting Base Vegetation Layer is derived annually considering a time-window of five years (e.g.&nbsp;2017 – 2021) to delineate the boundaries between grassland, cropland, tree cover and other land cover types (e.g.&nbsp;built-up areas, sealed areas, water, bare ground, permanent snow/ice, non-agricultural shrubs) not relevant for further processing steps within the HRL VLCC.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-96d4f7ffe37f4b6d5ba2b5ac9886614e2b0e3258.png" class="img-fluid figure-img"></p>
<figcaption>Figure 2: Production units subdividing the EEA-38 area into homogenous biogeographical substrata for the production of the BVL (GF: French Guiana, GP: Guadeloupe, MQ: Martinique, RE: Le Réunion, YT: Mayotte).</figcaption>
</figure>
</div>
</section>
<section id="post-classification-processing" class="level3" data-number="3.1.3">
<h3 data-number="3.1.3" class="anchored" data-anchor-id="post-classification-processing"><span class="header-section-number">3.1.3</span> Post-classification processing</h3>
<p>A sequence of post-processing steps is applied to improve the spatial and temporal consistency of the products. Spatial filtering aims to reduce salt and pepper noise and temporal filtering reduces frequent and implausible land cover changes (often along the class boundaries). The designation of overlap classes accounts for known overlaps in the nomenclatures and aims to minimize the inheritance of omission errors in the extent of herbaceous and cropland areas for further Grasslands and Croplands products.</p>
<p>An initial post-processing step involves applying bilateral filtering of the probabilities to reduce noise while preserving sharp spatial edges between land cover classes (Schindler 2012). This filtering is performed prior to rule-based harmonisation, ensuring that downstream products maintain spatially consistent classifications while avoiding excessive blurring at class boundaries and preserving ecologically meaningful edges. Subsequently the probabilities from any newly produced PU are blended with the readily available neighbouring PUs in an 10km overlap buffer. Within this buffer area the probabilities of all relevant PUs are averaged; the distance to the PU borders are used as a weight for the averaging to ensure seamless classification results.</p>
<p>In a further step change detection is performed to identify potential tree cover changes. To this end, the sum of the probabilities for tree cover (tree cover-broadleaved; tree cover-coniferous, tree crops) are considered; the difference of the sums is computed between the reference year at the intervals of the 3-yearly change layers (2018-2021-2024). Changes from a tree cover class to a non-tree cover class are allowed in the time-series if the difference of the tree cover probabilities exceed a certain threshold (see Section 3.2 for further details). Tree cover changes that do not exceed the thresholds are harmonized in the time-series to the class with the highest mean probability across a time-window of five years.</p>
<p>Finally, a rule-based postprocessing is applied to harmonize the 5-year classification, identify areas with potential overlaps among the different HRL VLCC products, and generate the final BVLs. Detected changes tree-cover changes are not modified by the rule-based processing.</p>
<p>The rules summarized in Table 1 are processed hierarchically so that latter rules overwrite the result of a previous rule for the same pixel:</p>
<p>Table 1: Overview of post-processing rules for the derivation of the harmonized annual BVLs.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 33%">
<col style="width: 33%">
<col style="width: 33%">
</colgroup>
<thead>
<tr class="header">
<th>Rule #</th>
<th>Rule</th>
<th>Purpose</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.</td>
<td>Five-year temporal sequences of herbaceous vegetation and the background class are recoded to sequences of herbaceous vegetation only.</td>
<td>Reduction of potential omission of herbaceous vegetation, especially in areas with dry grasslands.</td>
</tr>
<tr class="even">
<td>2.</td>
<td>Five-year temporal sequences of cropland and the background class are recoded to sequences of cropland only.</td>
<td>Avoid omission of temporarily fallow land from cropland processing extent.</td>
</tr>
<tr class="odd">
<td>3.</td>
<td>Five-year temporal sequences of cropland and herbaceous vegetation are recoded to class 7overlap herbaceous – cropland.</td>
<td>Reduce propagation of uncertainties in BVL classification for downstream processing of croplands and grasslands.</td>
</tr>
<tr class="even">
<td>4.</td>
<td>Any pixel with co-occurrence of tree cover and Tree Cover Density &lt;=10% in any of the last five reference years is assigned to class 6 overlaps of herbaceous and tree cover.</td>
<td>Account for the overlap of the definitions of the HRL Tree Cover &amp; Forests and HRL Grassland layer.</td>
</tr>
</tbody>
</table>
<p>Those processing rules result into two further potential overlap classes being identified:</p>
<ul>
<li><p>overlap herbaceous – cropland</p></li>
<li><p>overlaps of herbaceous and tree cover</p></li>
</ul>
<p>Pixels with overlap herbaceous – cropland are then subject to further processing by both the Cropland and the Grassland processor. Specifically, pixels initially labelled as Fodder Crops in a preliminary version of the Crop Type (CTY) product are removed from the CTY product and now assigned to the Herbaceous (HER) layer.</p>
<p>Areas identified as overlaps of herbaceous and tree cover can be designated as both herbaceous and tree cover by the Grassland and Tree Cover &amp; Forest processors, respectively. Similarly, areas identified as overlaps between crop and tree cover (i.e.&nbsp;tree crops) can appear in both the Cropland products and the Tree Cover &amp; Forest products.</p>
</section>
</section>
<section id="hrl-tree-cover-forests" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="hrl-tree-cover-forests"><span class="header-section-number">3.2</span> HRL Tree Cover &amp; Forests</h2>
<p>The HRL Tree Cover &amp; Forests products comprise several annual status and 3-yearly change layers which are partially derived from the outputs of the BVL classification and combined with separate processing chain to estimate Tree Cover Density. This section details the applied methods for the production of the Tree Cover &amp; Forests products. An overview of the workflow is provided in Figure 3.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-8c75bc7b81f884492f16d2dc812579fecc761de9.png" class="img-fluid figure-img"></p>
<figcaption>Figure 3: High-level flow chart of the production workflow for the Tree Cover &amp; Forests products TCD, DLT, TCPC and DLTC.</figcaption>
</figure>
</div>
<p>Dominant Leaf Type (DLT), Tree Cover Presence Change (TCPC) and Dominant Leaf Type Change (DLTC)</p>
<p>The BVL classification provides annual probabilities for coniferous trees, broadleaved trees and tree crops (e.g.&nbsp;fruit and olive trees). These probabilities serve as inputs for generating several forest-related products:</p>
<ul>
<li><p>Yearly <strong>Dominant Leaf Type (DLT)</strong></p></li>
<li><p>Yearly <strong>Tree Cover Presence Change (TCPC)</strong></p></li>
<li><p>Yearly <strong>Dominant Leaf Type Change (DLTC)</strong></p></li>
</ul>
<p>The derivation process begins with the detection of tree cover losses and gains based on the sum of the probabilities for tree cover (tree cover-broadleaved; tree cover-coniferous, tree crops). The difference of the sums of these probabilities is computed between the reference years at the intervals t1 and t2 of the 3-yearly change layers (e.g.&nbsp;between 2018 and 2021). Regionally calibrated thresholds are then applied to these probability differences whereas:</p>
<ul>
<li><p>Negative probability differences below the threshold are assigned as tree cover loss</p></li>
<li><p>Positive probability differences above the threshold are assigned as tree cover gain</p></li>
</ul>
<p>Vice-versa all probability changes that do not exceed the thresholds are discarded. For these rejected changes the most probable class across the 5-year period is assigned instead. Both accepted and rejected changes are then propagated back into the annual <strong>DLT</strong> and <strong>BVL</strong> layers to ensure consistency. Accepted changes are propagated to the time-step which has the highest difference in the time-series.</p>
<p>For example: The probability difference over three years (e.g.&nbsp;2018-2021) for tree loss is -60% and below a defined threshold of -45%. The change is accepted. In the three annual time steps (e.g.&nbsp;2018-2019, 2019-2020, 2020-2021) the probability differences are -20%, +10%, -50%. In this case the change is allocated in the last time-step of the annual status layers.</p>
<p>From this process an initial change pixel-based 3-annual change mask is obtained. This mask is aggregated to 20m resolution using the aggregation rules detailed in Annex I. To derive <strong>Tree Cover Presence Change (TCPC)</strong> a Minimum Mapping Unit (MMU) filter is applied (see Annex II for details) to:</p>
<ul>
<li><p>Eliminate change patches smaller than 1 hectare</p></li>
<li><p>Fill small gaps within valid change patches</p></li>
</ul>
<p>For the derivation of the <strong>Dominant Leaf Type Change (DLTC)</strong> the first step is the computation of a pixel-wise differences of the DLTs at t1 and t2 and its subsequent aggregation to 20m using the aggregation rules defined in Annex I. This raw version of the <strong>DLTC</strong> is subsequently masked and harmonized with the <strong>TCPC</strong>. For patches filled during the MMU filtering of the <strong>TCPC</strong> the leaf type information is complemented based on the majority of the surroundings in the raw <strong>DLTC</strong> to assure full consistency between <strong>TCPC</strong> and <strong>DLTC</strong>.</p>
<section id="tree-cover-density-tcd" class="level3" data-number="3.2.1">
<h3 data-number="3.2.1" class="anchored" data-anchor-id="tree-cover-density-tcd"><span class="header-section-number">3.2.1</span> Tree Cover Density (TCD)</h3>
<p>For the annual Tree Cover Density (TCD) layer (starting with the reference year 2018), the median spectral values of Sentinel-2 bands (B02, B03, B04, B08, B11 and B12) are computed for the vegetation season of each reference year. In areas, affected by persistent snow or heavy cloud cover alternative percentiles of the respective bands are used to minimize potential artefacts in the product. These spectral inputs are complemented by the mean classification probabilities for coniferous trees, broadleaved trees and tree crops resulting from the <strong>BVL</strong> classification.</p>
<p>To train the model, reference samples are drawn from the previous version of HRL TCD 2018 using a stratified sampling approach over areas with stable tree cover across all 5 reference years. A CatBoost regression model (Dorogush et al.&nbsp;2018) is then trained with these yearly input data for the respective production unit and used to estimate the TCD for each reference year over the full extent of the PU. The model calibration involves a grid-search during which different degrees of oversampling of lower and highest TCD value ranges are tested. The aim of this gridsearch is to reduce the underestimation of these values ranges in the final layer.</p>
<p>In a subsequent post-processing step, the yearly TCD are harmonised by applying a histogram matching technique (Coltuc et al.&nbsp;2006) and an additional smoothing step to limit sudden implausible spikes in the TCD over time. Lastly, the DLT classification is applied on top of the TCD to mask out non-tree covered areas, ensuring the final product reflects only valid tree cover.</p>
<p>A series of further layers is derived from the TCD, DLT as well of other ancillary datasets. An overview of the dependencies of these derived products is provided in Figure 4 and detailed in the following paragraphs.</p>
</section>
<section id="forest-additional-support-layer-fadsl" class="level3" data-number="3.2.2">
<h3 data-number="3.2.2" class="anchored" data-anchor-id="forest-additional-support-layer-fadsl"><span class="header-section-number">3.2.2</span> Forest Additional Support Layer (FADSL)</h3>
<p>The <strong>Forest Additional Support Layer (FADSL)</strong> at 10m spatial resolution is used to separate real “forest” areas from non-forest areas (i.e.&nbsp;trees predominantly used for agricultural practices, trees in urban context) in order to derive a <strong>Forest Type</strong> product which is largely following the FAO definition. The respective areas are derived through a rule-based spatial intersection of the 10m <strong>DLT</strong> and <strong>TCD</strong> layers with <strong>CLC</strong> 2018 and <strong>IMD</strong> 2018.</p>
<ol type="1">
<li><span data-custom-style="NormalLine">Generation of a binary mask with</span><br>
</li>
</ol>
<ul>
<li><p>0: non-impervious: <strong>HRL IMD</strong> == 0</p></li>
<li><p>1: impervious: <strong>HRL IMD</strong> &gt; 0</p></li>
</ul>
<ol start="2" type="1">
<li><p>Filtering of all contiguous all non-impervious patches &lt; 25 ha which are fully surrounded by impervious areas in a 4-pixel connectivity mode and subsequently reclassification to 1 = all impervious areas.</p></li>
<li><p>Hierarchical intersection of the <strong>DLT</strong> (with <strong>TCD</strong> ranging from 10-100%), <strong>CLC 2018</strong> (vector geometries rasterized at 10m spatial resolution) and the gap-filled imperviousness dataset as detailed in Table 2 .</p></li>
</ol>
<p>Table 2 FADSL - hierarchical intersection of input layers and resulting thematic classes</p>
<table class="caption-top table">
<colgroup>
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
<col style="width: 16%">
</colgroup>
<thead>
<tr class="header">
<th>Order</th>
<th>DLT Class</th>
<th>CLCClass</th>
<th>IMDClass</th>
<th>FADSLClass</th>
<th>Class Description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.)</td>
<td>1 or 2</td>
<td>any</td>
<td>1</td>
<td>4</td>
<td>trees in urban context – broadleaved and coniferous (from HRL Imperviousness context)</td>
</tr>
<tr class="even">
<td>2.)</td>
<td>1 or 2</td>
<td>141</td>
<td>0</td>
<td>5</td>
<td>trees in urban context – broadleaved and coniferous (from CLC class 1.4.1)</td>
</tr>
<tr class="odd">
<td>3.)</td>
<td>1</td>
<td>222or223</td>
<td>any</td>
<td>3</td>
<td>trees predominantly used for agricultural practices – broadleaved (from CLC classes 2.2.2 and 2.2.3)</td>
</tr>
<tr class="even">
<td></td>
<td>255</td>
<td>any</td>
<td>any</td>
<td>255</td>
<td>outside area (predefined through boundary layer)</td>
</tr>
<tr class="odd">
<td></td>
<td>any other remaining combination</td>
<td>any other remaining combination</td>
<td>any other remaining combination</td>
<td>0</td>
<td>all non-tree areas, and tree cover without urban context or agricultural use</td>
</tr>
</tbody>
</table>
<p>It is worth mentioning that the derived delineation of non-forest tree cover areas has certain limitations due to the specifications and thematic accuracies of the different input data (<strong>DLT</strong> with density values ranging from 10-100%; <strong>CLC</strong> 2018 with 25 ha MMU; <strong>IMD</strong> 2018 also representing infrastructure). This includes the frequency and timelines of updates which imposes the need use input layers that predate the actual reference year of the <strong>FTY</strong> (e.g.&nbsp;<strong>FTY</strong> 2021 was produced using still CLC 2018 and the first version of the <strong>HRL IMD</strong> 2018.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-ca3af50470b86f297c48a5a7e3b6625919df0077.png" class="img-fluid figure-img"></p>
<figcaption>Figure 4: High-level flow chart of the production workflow for the Tree Cover &amp; Forests products FADSL, FTY and aggregated products at 100m.</figcaption>
</figure>
</div>
</section>
<section id="forest-type-fty" class="level3" data-number="3.2.3">
<h3 data-number="3.2.3" class="anchored" data-anchor-id="forest-type-fty"><span class="header-section-number">3.2.3</span> Forest Type (FTY)</h3>
<p>The <strong>Forest Type (FTY)</strong> layer implements forest maps largely following the definition provided by the Food and Agriculture Organization (FAO), as specified in the terms and definitions of the <em>Global Forest Resources Assessment (FRA) Working Paper 1 (FAO, 2012)</em>. The 10m FTY product is computed by applying the FAO´s definition, however, for EEA-specific purposes, it explicitly includes tree cover in traditional agroforestry systems, such as Dehesa and Montado, which are typically excluded under standard FAO criteria.</p>
<p>In a first step an intermediate tree cover mask product is derived through spatial intersection of the two primary status layers <strong>TCD</strong> (≥ 10-100%) and *<strong>DLT</strong>, where areas under agricultural use and in urban context as provided by the <strong>FADSL</strong> are excluded. To ensure consistency with the specified Minimum Mapping Unit (MMU) of 0.5 hectares (equivalent to 50 pixels), the resulting tree cover mask is refined using the GDALSieve<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a> operation. This operation removes small patches below the MMU and fills in small gaps. The output is used to create an initial version of the Forest Type product, that is still missing information in areas, which were filled and marked as tree cover during the sieving process. Furthermore, an ancillary mask is created by mapping these specific pixels with no data values. The GDALFillNodata<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> function is used to assign values to the pixel shown in the ancillary mask by using an inverse distance weighting algorithm to fill NoData areas based on the values of surrounding pixels. In the last formatting step those interpolated areas and the initial Forest Type version are combined to form the final Forest Type product, which is finally aligned to the processing extent as given in the official Boundary Layer (EEA, 2023).</p>
</section>
<section id="aggregated-products---tree-cover-density-tcd-100m-broadleaved-cover-density-bcd-coniferous-cover-density-ccd" class="level3" data-number="3.2.4">
<h3 data-number="3.2.4" class="anchored" data-anchor-id="aggregated-products---tree-cover-density-tcd-100m-broadleaved-cover-density-bcd-coniferous-cover-density-ccd"><span class="header-section-number">3.2.4</span> Aggregated products - Tree Cover Density (TCD) 100m, Broadleaved Cover Density (BCD) &amp; Coniferous Cover Density (CCD)</h3>
<p>The TCD at 100m spatial resolution is derived through spatial aggregation from the 10m TCD status layer for the respective reference year. The 100m LAEA grid is used to calculate the arithmetic mean density of all underlying 10m pixels (with density values from 0-100) for each 100m cell. The thereof resulting mean values from the aggregation (floating point data type) are rounded and finally converted to integer values (e.g.&nbsp;raw values in the range from 33.5 to 34.4 are converted to a density value of 34).</p>
<p>Several further layers are derived through operations of intersection and aggregations including <strong>Broadleaved Cover Density (BCD)</strong> and <strong>Coniferous Cover Density (CCD)</strong> layers. <strong>BCD</strong> is the aggregated density of broadleaved trees and shows the percentage of broadleaved pixels in the <strong>DLT</strong> for the respective reference year while <strong>CCD</strong> is the aggregated density of coniferous trees and shows the percentage of coniferous pixels. Both <strong>BCD</strong> and <strong>CCD</strong> layers are derived through aggregation of the 10m <strong>DLT</strong>. The 100m LAEA grid is overlaid to the 10m <strong>DLT</strong> product. Within each 100m cell the number of broadleaved and coniferous pixels are counted and the respective percentages stored into 100m pixel of the <strong>CCD</strong> and <strong>BCD</strong>, respectively.</p>
</section>
<section id="aggregated-products---forest-type-fty-100m" class="level3" data-number="3.2.5">
<h3 data-number="3.2.5" class="anchored" data-anchor-id="aggregated-products---forest-type-fty-100m"><span class="header-section-number">3.2.5</span> Aggregated products - Forest Type (FTY) 100m</h3>
<p>The <strong>FTY</strong> at 100m spatial resolution is derived through spatial aggregation from the FTY 10m status layer based on the spatially consistent EEA 100m grid. The first step is to identify forest covered 100m cells by counting and summing up all forest pixels (broadleaved and coniferous) of the 10m FTY product within the respective grid cell. If the number of forest pixels is ≥ 50, the 100m grid cell is assigned to “forest cover”. In case a 100m cell contains less than 50 forest covered 10m pixels, it will be labelled as all non-forest areas in the final product.</p>
<p>After identifying the forest areas, the CORINE Land Cover definition for broadleaved, coniferous and mixed forest is applied. The class broadleaved forest is assigned in 100m grid cells, which contain ≥75% forest pixels belonging to broadleaved. If a 100m grid cells consists of ≥ 75% coniferous pixels within the forested area it is assigned to coniferous forest. Areas in which neither “broadleaved” nor “coniferous” constituents account for ≥75% of the 10m forest pixels are labelled as mixed zones.</p>
</section>
<section id="dominant-leaf-type-confidence-layer-dltcl" class="level3" data-number="3.2.6">
<h3 data-number="3.2.6" class="anchored" data-anchor-id="dominant-leaf-type-confidence-layer-dltcl"><span class="header-section-number">3.2.6</span> Dominant Leaf Type Confidence Layer (DLTCL)</h3>
<p>The <strong>DLTCL</strong> uses the probabilities gained during <strong>BVL</strong>/<strong>DLT</strong> computation from the Temporal convolutional neural network to compute classification confidence. The classification confidence is considered here as the probability margin between the highest and second highest ranked leaf type class. The margin is derived by calculating the absolute difference values of probabilities for coniferous and broadleaved tree cover classes. High confidence (up to 100%) indicates domination of one class, whereas lower values (close to 0%) are typical for areas with similar probabilities, suggesting uncertainty or mixed tree cover types.</p>
</section>
<section id="tree-cover-density-confidence-layer-tcdcl" class="level3" data-number="3.2.7">
<h3 data-number="3.2.7" class="anchored" data-anchor-id="tree-cover-density-confidence-layer-tcdcl"><span class="header-section-number">3.2.7</span> Tree Cover Density Confidence Layer (TCDCL)</h3>
<p>The <strong>TCDCL</strong> uses the Total Uncertainty (Variance) metric calculated from CatBoost algorithm to derive the standard deviation for each estimated TCD value. Total uncertainty is the sum of data and knowledge uncertainty. The former can be seen as a measure for data complexity due to noisy data or overlapping classes. Knowledge uncertainty is obtained from a single CatBoost model by using virtual ensembles (Malinin et al.&nbsp;2020). If this option is enabled during the CatBoost run the one existing model is basically divided into (n) separate models. The annual <strong>TCD</strong> production was done with ()=10. Based on these 10 models Knowledge uncertainty is computed by the variance of the mean values predicted by all models. Low <strong>TCDCL</strong> values indicate high confidence in the estimated <strong>TCD</strong> value.</p>
</section>
<section id="tree-cover-presence-change-confidence-layer-tcpccl" class="level3" data-number="3.2.8">
<h3 data-number="3.2.8" class="anchored" data-anchor-id="tree-cover-presence-change-confidence-layer-tcpccl"><span class="header-section-number">3.2.8</span> Tree Cover Presence Change Confidence Layer (TCPCCL)</h3>
<p>The <strong>TCPCCL</strong> relies as well on the probabilities for coniferous and broadleaved tree cover classes gained during <strong>BVL</strong>/<strong>DLT</strong> computation to calculate change confidence. The change confidence here refers to the change in combined tree cover probability from 2018 to 2021. This is done by summing up the probabilities for coniferous and broadleaved tree cover classes for each reference year and afterwards the absolute difference is calculated between 2018 and 2021 respectively. High values signal a big difference between both years and thus a high confidence in change detection, whereas lower values indicate some uncertainty.</p>
</section>
<section id="encountered-issues-and-known-limitations" class="level3" data-number="3.2.9">
<h3 data-number="3.2.9" class="anchored" data-anchor-id="encountered-issues-and-known-limitations"><span class="header-section-number">3.2.9</span> Encountered issues and known limitations</h3>
<p><strong>Omission of sparse tree cover</strong> is commonly known challenge for tree cover mapping since lower canopy cover leads to a mixed reflectance signal that becomes increasingly dominated by the understory. The issue is further aggravated by imperfections of the multi-temporal coregistration of the Sentinel-2 data. Sparse tree cover is common at the timber line but in particular in the Mediterranean comprising agroforestry systems (Dehesas, Montados) and Olive Groves. Initial classifications for the Iberian Peninsula and Southern Italy revealed large areas of Olive Groves and Dehesas which triggered a reprocessing. This included the revision of approximately 7000 additional samples and the collection of around 5500 additional tree cover samples. Retraining the model with the revised sample database indeed provided major improvements. Further enhancements were implemented also in the post-processing to boost tree cover probabilities in areas designated as Agroforestry, Olive Groves and other type of tree cover according to the Corine Land Cover layer for 2018. An example for the status of the DLT before and after the reprocessing is provided in Figure 5. Though the reprocessing has significantly reduced the amount of omission errors, tree cover omission is generally still more pronounced in the Mediterranean region.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-76519c7ec6c010f538a443731db40973837bf1f3.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>Figure 5: Dominant Leaf Type for the reference year 2021 a) after initial classification and b) after reprocessing for agroforestry system in Andalusia, Spain (LAEA 3044254.4m, 1822153.02m) Background Google Maps VHR imagery 03/2021.</figcaption>
</figure>
</div>
<p>The employed regression-based method for the estimation of the <strong>Tree Cover Density</strong> is generally sensitive to the propagation of <strong>artefacts resulting from cloud cover and topographic effects</strong> from the input satellite imagery. The usage of median time features is in most cases robust to such artefacts but some issues have been encountered frequently, not all of which could be fully resolved in the final layers.</p>
<p>This concerns topographic effects where cast shadows result in dark features in the imagery and an overestimation of the <strong>TCD</strong>. Similarly, the topographic correction of the Sentinel-2 L2A processor tends to overestimate reflectance on north and north-west facing slopes which in turn can lead to an underestimation of the <strong>TCD</strong>. Such topographic effects are typically more pronounced at higher latitudes with lower sun angles. An example is provided in Figure 6.</p>
<p>Underestimations and spatial patterns that are not related to actual variations of the canopies can also be caused by cloud cover. On the one hand, this can be caused by clouds that are not detected in the SCL accompanying the Sentinel-2 L2A data. On the other hand, frequent cloudcover during the peak period of the vegetation season can lead to a higher impact of scenes from early spring that may depict broadleaved deciduous tree (especially those with later leaf emergence such as Fagus and Quercus) still with leaf off conditions. A rigorous quality control was conducted to detect such artefacts and adjust parameters for median time-feature computation as much as possible. This included for example the usage of shorter time-windows (starting only in May) or alternative statistical metrics such as 25th- and 75th percentiles. While this enabled to significantly reduced the amount of artefacts as illustrated in Figure 7, it was not possible to fully resolve all cases encountered.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-bc1b609dee87f1e9ffa5ba0bf47c2f4e63f371a2.png" class="img-fluid figure-img" style="width:70.0%"></p>
<figcaption>Figure 6: Example for an area with imprints of topographic effects into the Tree Cover Density layer in Northern Norway (LAEA. 4833337.67m, 5288588.26m) a) VHR image 07/2021 (Google Maps) b) final TCD layer for 2021 and c) median of S-2 L2A band 3 over the vegetation season.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-2dd3407d3fdf8a7517f3847a38faefdfec124e4d.png" class="img-fluid figure-img"></p>
<figcaption>Figure 7: Example for initial TCD underestimation due to proportional high number of early spring scenes with trees in leaf-off conditions in Northern Germany (LAEA, 4186992.95m 3368117.83m). a) initial (unmasked) TCD estimates using median features for March – October 2021 and showing severe underestimation for broadleaved deciduous canopies, b) VHR image 2021 and c) final TCD based on reduced time window from May to September 2021 and percentile features.</figcaption>
</figure>
</div>
</section>
</section>
<section id="hrl-grasslands-status-and-change-layers" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="hrl-grasslands-status-and-change-layers"><span class="header-section-number">3.3</span> HRL Grasslands status and change layers</h2>
<p>This section gives an overview of the methodology employed to produce the layers <strong>Herbaceous Cover (HER)</strong>, <strong>Ploughing Indicator (PLOUGH)</strong>, <strong>Grassland (GRA)</strong> and <strong>Grassland Change (GRAC)</strong>.</p>
<section id="input-data-1" class="level3" data-number="3.3.1">
<h3 data-number="3.3.1" class="anchored" data-anchor-id="input-data-1"><span class="header-section-number">3.3.1</span> Input data</h3>
<p>All grassland products described in the following subsections are based on a common set of input and auxiliary data. The main source of information is the Base Vegetation Layer (<strong>BVL</strong>), specifically the probability associated with the herbaceous class serves as a starting point for subsequent derivations.</p>
<p>In addition to the <strong>BVL</strong>, different sets of auxiliary data are needed:</p>
<ul>
<li><p><strong>Corine Land Cover (CLC 2018)</strong><a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a> (to dampen the probability of certain areas)</p></li>
<li><p><strong>CLCplus Backbone 2018 (CLCplus BB)</strong><a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a> (as reference to derive probability thresholds)</p></li>
<li><p><strong>HRL Grassland</strong> 2018<a href="#fn5" class="footnote-ref" id="fnref5" role="doc-noteref"><sup>5</sup></a> (as reference to derive probability thresholds)</p></li>
<li><p>Previous version of <strong>HRL Ploughing Indicator</strong> 2018 (to mark ploughing events before availability of S2 data in 2017)</p></li>
</ul>
</section>
<section id="sec-Herbaceous-Cover" class="level3" data-number="3.3.2">
<h3 data-number="3.3.2" class="anchored" data-anchor-id="sec-Herbaceous-Cover"><span class="header-section-number">3.3.2</span> Herbaceous Cover (HER)</h3>
<p>The production of the <strong>Herbaceous Cover (HER)</strong> is primarily based on the probability estimates obtained from the <strong>Base Vegetation Layer (BVL)</strong> which also serves to harmonise the different vegetated <strong>HRL</strong> products, including <strong>HRL Grasslands</strong>, <strong>Tree Cover &amp; Forests and Croplands</strong>. The <strong>BVL</strong> is created annually (2017-2021) and using probability estimates of various land cover types.</p>
<p>To derive the herbaceous layer, various operations are performed on the probability estimates to either locally increase or decrease the herbaceous probabilities. The <strong>Corine Land Cover (CLC)</strong> 2018 layer is applied to weight the probabilities for some classes such as peat bogs, sclerophyllous vegetation and others to eliminate false positives from the 2018 reference year classification. To determine the final herbaceous layer, a suitable threshold must be established for each processing unit (i.e.&nbsp;EEA tile). Probabilities above this threshold are considered to be herbaceous. The thresholds are calibrated using additional CLMS products, the previous version of <strong>HRL Grassland</strong> 2018 and <strong>CLC</strong> 2018. The <strong>BVL</strong> herbaceous probabilities are compared with all matching pixels from these layers. This ensures that only pixels are considered where both layers indicate the same land cover type. The threshold is chosen dynamically by finding the probability which maximizes the accuracy between the herbaceous <strong>BVL</strong> probability and the CLMS products. To avoid a too general (or even constant) threshold for the whole EEA tile, the accuracy is matched in 16 sub-tiles and then interpolated over the whole tile using a Gaussian filter. This process ensures that strong differences in landscape and vegetation within an EEA tile are still addressed.</p>
<p>To further tune these <strong>HER</strong> thresholds a manual inspection using visually interpreted sample points is conducted. In case of strong over- or underestimation the process can be rerun manually forcing the algorithm to use increased or decreased thresholds.</p>
<p>Moreover, the probabilities between yearly layers are harmonized to reduce rapid changes that are often due to classification noise. This achieved by calculating the (fast) Dynamic Time Warp (DTW) of the time-series of two subsequent years using the <strong>Vegetation Phenology and Productivity– Plant Phenology Index (HR-VPP PPI)<a href="#fn6" class="footnote-ref" id="fnref6" role="doc-noteref"><sup>6</sup></a></strong> time-series (Salvador et. al.&nbsp;2007). All yearly binary HER layers are finally determined by applying the threshold found in the procedure described above. Further details follow in the <strong>Grassland Change (GRAC)</strong> layer section 3.3.6.</p>
<p>Additionally, the binary HER layer is enriched with information from the <strong>Crop Types (CTY)</strong> layer. All pixels classified as fodder crop (class 1500) are included (for each year respectively) in the binary <strong>HER</strong> layer. Finally, the herbaceous extent is clipped to the yearly <strong>BVL</strong>.</p>
<p><strong>The following steps are needed to derive the herbaceous products:</strong></p>
<ul>
<li><p>Retrieve herbaceous probability estimates from <strong>BVL</strong> herbaceous class.</p></li>
<li><p>Find threshold in reference year by maximizing accuracy when compared to CLMS products</p></li>
<li><p>Tune probability estimates</p>
<ul>
<li><p>Dampen probabilities of selected classes using <strong>CLC</strong> 2018 to eliminate false positives.</p></li>
<li><p>Harmonize probabilities between yearly layers to reduce rapid changes.</p></li>
</ul></li>
<li><p>Apply threshold to all years to determine binary layers</p></li>
<li><p>Mask herbaceous layer</p></li>
<li><p>Data outputs (creation of the Cloud-Optimized-GeoTiffs, colortables, metadata)</p></li>
</ul>
</section>
<section id="ploughing-indicator-plough" class="level3" data-number="3.3.3">
<h3 data-number="3.3.3" class="anchored" data-anchor-id="ploughing-indicator-plough"><span class="header-section-number">3.3.3</span> Ploughing Indicator (PLOUGH)</h3>
<p>The <strong>PLOUGH</strong> indicator is generated by analysing a combination of data sources: a series of binary <strong>HER</strong> (herbaceous) classification layers, <strong>BVL</strong> (Base Vegetation Layer) classes, and <strong>HR VPP PPI</strong> (Plant Phenology Index) quantiles.</p>
<ul>
<li><p><strong>BVL</strong> classes 4 (crop) and 7 (transition between herbaceous and crop) are used as indicators of a ploughing event.</p></li>
<li><p>Low <strong>PPI</strong> quantiles signal periods of low vegetation, which may correspond to ploughing activity.</p></li>
</ul>
<p>For reference years before 2017, where data is missing, the system uses ploughing records from the historic <strong>PLOUGH (HIS-PLOUGH)</strong> product, which can introduce certain inconsistencies (see section 3.3.9).</p>
<p>The algorithm works by detecting the first break in a continuous series of <strong>HER</strong> classifications—a potential sign of ploughing. If such a break is found, it’s labelled as a “possible ploughing event” and is then cross-checked with both the PPI data and <strong>BVL</strong> classification to confirm if ploughing actually occurred.</p>
<ul>
<li><p>If the break is confirmed, it’s recorded as a ploughing event.</p></li>
<li><p>If it’s not confirmed, the pixel is either:</p>
<ul>
<li><p>Reclassified as <strong>HER</strong> (if the <strong>BVL</strong> suggests it’s still herbaceous because it’s inside a crop class), or</p></li>
<li><p>Assigned to Class 100, indicating a change in HER cover but not due to ploughing.</p></li>
</ul></li>
</ul>
<p>If no break is found, the pixel is excluded from the PLOUGH layer but will still be included as grassland in the GRA layer. See Figure 8 for a visualization of the workflow as a flowchart.</p>
<p>To reduce salt-and-pepper noise, the final <strong>PLOUGH</strong> layer is filtered using a minimum mapping unit (MMU) of 0.03 ha (i.e.&nbsp;3x10m pixels). Since the processing based on 100km tiles, this step includes gathering intermediate version of all neighbouring tiles to avoid edge-effects at the tile borders.</p>
<p>Data outputs include the creation of Cloud-Optimized GeoTIFFs, accompanying colour tables, and detailed metadata.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-da90c1314ea785b85e939102f3c1d3f6e81a9387.png" class="img-fluid figure-img"></p>
<figcaption>Figure 8: Flowchart of the PLOUGH decision logic</figcaption>
</figure>
</div>
</section>
<section id="grassland-gra" class="level3" data-number="3.3.4">
<h3 data-number="3.3.4" class="anchored" data-anchor-id="grassland-gra"><span class="header-section-number">3.3.4</span> Grassland (GRA)</h3>
<p>The <strong>Grassland (GRA)</strong> layers are directly derived from the <strong>Herbaceous Cover (HER)</strong> and <strong>Ploughing (PLOUGH)</strong> layers. A pixel is considered to be grassland if it has been herbaceous for five consecutive years7. To retrieve this information the corresponding binary HER <strong>layer</strong> is masked with the corresponding <strong>PLOUGH</strong> layer, leaving only <strong>HER</strong> pixels which have not been ploughed in the previous year.</p>
<p>Like the <strong>HER</strong> layer, each Grassland layer is clipped to the yearly <strong>BVL</strong> extent and filtered to a MMU of 0.03 ha. However, only class 1 of the <strong>BVL</strong> is used to mask the GRA layer (unlike classes 1, 6 and 7 for HER), since overlaying classes 6 and 7 do not allow grassland classifications.</p>
<p><strong>The following steps are needed to derive the HRL Grasslands layers:</strong></p>
<ul>
<li><p>Mask binary <strong>Herbaceous Cover (HER)</strong> with ploughing indicator to determine grassland layer</p></li>
<li><p>Mask <strong>Grassland (GRA)</strong> layer to yearly <strong>BVL</strong> (class 1 only)</p></li>
<li><p>Application of the MMU 0.03 ha (i.e.&nbsp;of 3 x 10m pixels). Since the processing based on 100km tiles, this step includes gathering intermediate version of all neighbouring tiles to avoid edge-effects at the tile borders.</p></li>
<li><p>Finalizing steps (creation of the Cloud-Optimized-GeoTiffs, colortables, metadata)</p></li>
</ul>
<p>The application of the MMU and the finalization steps are performed only after all tiles have been processed to also take border regions of adjacent tiles into account.</p>
</section>
<section id="grassland-confidence-gracl" class="level3" data-number="3.3.5">
<h3 data-number="3.3.5" class="anchored" data-anchor-id="grassland-confidence-gracl"><span class="header-section-number">3.3.5</span> Grassland Confidence (GRACL)</h3>
<p>The <strong>Grassland Confidence Layer (GRACL)</strong> gives an estimate of how confident the classification was in predicting a certain grassland pixel. It is derived as the mean taken over the respective herbaceous confidence values. These are not an actual layer but are still derived in the workflow process. The herbaceous confidence for any year is the difference between an herbaceous probability taken from the <strong>BVL</strong> and the second highest probability. Therefore, the higher the herbaceous probability is, the greater the difference to the second highest probability and therefore also a higher herbaceous confidence value. In case another probability is higher than the herbaceous probability, the confidence value is set to zero.</p>
<p>The grassland confidence is then simply derived as the mean of the relevant herbaceous confidence layers.</p>
<p>Furthermore, the layer is clipped to actual grassland pixels. Note, that it is possible, even though unlikely, that a grassland pixel can result in having a confidence value of zero, if the mean of all herbaceous confidence values resulted in zero.</p>
</section>
<section id="sec-GRAC" class="level3" data-number="3.3.6">
<h3 data-number="3.3.6" class="anchored" data-anchor-id="sec-GRAC"><span class="header-section-number">3.3.6</span> Grassland Change (GRAC)</h3>
<p>As described above, the main part of the processing and time-series analysis is carried out in the processing of the herbaceous layer as this builds the fundament of any subsequently derived layer. For the change detection, it is specifically important to include a sophisticated time-series analysis into the herbaceous classification to prevent false class-flips between consecutive years and therefore to avoid artificial changes introduced by classification noise by calculating the (fast) Dynamic Time Warp (DTW) of the time-series of two subsequent years as already described in section <a href="#sec-Herbaceous-Cover" class="quarto-xref">Section&nbsp;3.3.2</a> In principle, various vegetation indices, such as Normalised Difference Vegetation Index (NDVI), Enhanced Vegetation Index (EVI) or Leave Area Index (LAI), can be utilized to accomplish this objective. However, for ease of use and availability, it was decided to use <strong>HR-VPP PPI<a href="#fn7" class="footnote-ref" id="fnref7" role="doc-noteref"><sup>7</sup></a></strong> time-series for this analysis.</p>
<p>Depending on the similarity of the time-series in terms of DTW, the raw herbaceous classification probabilities are adapted according to the following formula:</p>
<p><span class="math display">\[
p_{1,\text{new}} = (1 - f) \cdot p_1 + f \cdot p_2
\]</span></p>
<p>with</p>
<p><span class="math display">\[
f =
\begin{cases}
0 &amp; \text{for } \mathrm{DTW}(y_1, y_2) &lt; th_{\min} \\
1 &amp; \text{for } \mathrm{DTW}(y_1, y_2) &gt; th_{\max} \\
\frac{\mathrm{DTW}(y_1, y_2) - th_{\min}}{th_{\max} - th_{\min}} &amp; \text{otherwise}
\end{cases}
\]</span></p>
<p>In this equation, <span class="math inline">\(p_1\)</span> and <span class="math inline">\(p_2\)</span> represent the herbaceous classification probabilities for the two years, while <span class="math inline">\(y_1\)</span> and <span class="math inline">\(y_2\)</span> stand for their corresponding vegetation sensitive index time-series, specifically the <strong>HR-VPP PPI<a href="#fn8" class="footnote-ref" id="fnref8" role="doc-noteref"><sup>8</sup></a></strong> time-series. This approach allows to define two thresholds, <span class="math inline">\(th_{\min}\)</span> and <span class="math inline">\(th_{\max}\)</span> which define the level of similarity that must be reached by the two signals to allow or suppress a possible class switch in the <strong>Herbaceous Cover (HER)</strong>. In simple terms, the DTW gives a low value for very similar time series and a high value if the time-series are different. If no change is seen, the classification probability of the previous year is kept. Values in between the two thresholds are linearly interpolated. For the production, the thresholds were set to 0,5 and 1,5, respectively.</p>
<p><strong>After the grassland layers have been processed with the above algorithm, the derivation of the grassland change follows the following steps:</strong></p>
<ul>
<li><p>Aggregation to 20m by a majority rule (see aggregation rules in Annex II)</p></li>
<li><p>Assignment of the GRAC classes:</p>
<ul>
<li><p>0: Non-grassland in both years</p></li>
<li><p>1: Grassland gain</p></li>
<li><p>2: Grassland loss</p></li>
<li><p>10: Grassland in both years</p></li>
</ul></li>
<li><p>Application of the MMU of 1.0 ha (i.e.&nbsp;25 x 20m pixels) for grassland losses and gains by the following steps:</p>
<ul>
<li><p>Mask creation for losses and gains</p></li>
<li><p>Sieving of all classes with the above size threshold. Since the processing based on 100km tiles, this step includes gathering intermediate version of all neighbouring tiles to avoid edge-effects at the tile borders.</p></li>
</ul></li>
<li><p>Application of the filtered layer in masked parts</p></li>
<li><p>Data output (creation of the Cloud-Optimized-GeoTiffs, colour tables, metadata)</p></li>
</ul>
<p>The application of the MMU and the finalisation steps are performed only after all tiles have been processed to also take border regions of adjacent tiles into account.</p>
</section>
<section id="grassland-change-confidence-layer-graccl" class="level3" data-number="3.3.7">
<h3 data-number="3.3.7" class="anchored" data-anchor-id="grassland-change-confidence-layer-graccl"><span class="header-section-number">3.3.7</span> Grassland Change Confidence Layer (GRACCL)</h3>
<p>The <strong>Grassland Change Confidence Layer (GRACCL)</strong> gives an estimate on the confidence for the grassland gains and losses derived in the Grassland Change layer. To derive this confidence value the grassland probability layers from 2018 and 2021 are needed. These are derived by applying the mean to all for the reference year relevant herbaceous layers (e.g.&nbsp;for the 2021 grassland probability the mean over all herbaceous layers from 2017-2021 are used, since all those reference years influence those probabilities.</p>
<p>The grassland change confidence value is then derived as</p>
<p><span class="math display">\[
GRACCL = \left( p_1 \cdot (1 - p2) + p2 \cdot (1 - p1) \right) \cdot 100
\]</span></p>
<p>where p1 is the grassland probability of the first reference year and p2 is the grassland probability of the second reference year.</p>
<p>This value is only derived for grassland change pixels which identify as grassland gains or losses.</p>
</section>
<section id="aggregated-products-grassland-gra100m" class="level3" data-number="3.3.8">
<h3 data-number="3.3.8" class="anchored" data-anchor-id="aggregated-products-grassland-gra100m"><span class="header-section-number">3.3.8</span> Aggregated products – Grassland (GRA)100m</h3>
<p>A further 100m Grassland layer is derived through aggregation from the Grassland layer at 10m spatial resolution. To this end, all grassland 10m GRA pixels within the extent of a GRA 100m pixel are counted and reported as the aggregated GRA 100m value in the range [0, 100]. No data values such as 255 are ignored and not counted during the aggregation.</p>
</section>
<section id="encountered-issues-and-known-limitations-1" class="level3" data-number="3.3.9">
<h3 data-number="3.3.9" class="anchored" data-anchor-id="encountered-issues-and-known-limitations-1"><span class="header-section-number">3.3.9</span> Encountered issues and known limitations</h3>
<p>Initial tests demonstrated that the <strong>HER time-series</strong> was susceptible to false positive changes which in turn generated false positive changes in the <strong>GRA</strong> time-series and the <strong>GRAC</strong>.</p>
<p>This issue was addressed by harmonizing the <strong>HER</strong> time-series by comparing it with a change layer derived from the <strong>HR-VPP PPI</strong> (see <a href="#sec-GRAC" class="quarto-xref">Section&nbsp;3.3.6</a>). A <strong>HER</strong> pixel is only allowed to change from one year to the next if there is a strong enough signal change detected in the <strong>HR-VPP PPI</strong>. The rules were applied more rigorously to ensure a higher consistency. The following <strong>Error! Reference source not found</strong>. shows an example of the <strong>GRAC</strong> layer in EEA tile E39N31 comparing changes from the previous test production vs.&nbsp;the processor deployed in production. The number of positive and negative changes decreased significantly due to the harder constraints on change during the years. The restrictions on <strong>HER</strong> layers being more consistent throughout the years propagates further to the <strong>GRA</strong> and <strong>GRAC</strong> layers.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-8719e7bd2267f1c5464a04d53f8f28dfc13d0098.png" class="img-fluid figure-img"></p>
<figcaption>Figure 9: Comparison of GRAC layers from test production and current production taken from EEA tile E39N31 (upper example in the centre around (3957750, 3114334), lower example in the centre around (3984094, 3150073). Blue areas indicate grassland gain, red areas indicate grassland loss (for year 2018 to 2021).</figcaption>
</figure>
</div>
<p>The <strong>HIS-PLOUGH</strong> from 2012 to 2015 is based on Landsat data and hence not fully consistent in terms of quality and resolution (20m) with the <strong>PLOUGH</strong> for later reference years (10m, based on Sentinel-2). This issue was already realized during the HRL 2018 production and at the time it was decided to rely on the <strong>HIS-PLOUGH</strong> for the years 2016-2018 only<a href="#fn9" class="footnote-ref" id="fnref9" role="doc-noteref"><sup>9</sup></a>. The same strategy would lead to continuously decreasing grassland extent in the 2017-2021 time series and thus, the full <strong>PLOUGH</strong> time series was hence considered to mitigate the issue. However, the variable resolution and quality of the early <strong>HIS-PLOUGH</strong> years still propagates to some degree to the <strong>Grassland (GRA)</strong> time-series (<strong>Error! Reference source not found.</strong>).</p>
<p>This limitation is generally difficult to be solved completely due to the unavailability of suitable Sentinel-2 time-series before 2017.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-1361d85aaefb1873757c904fc85aa2aa2698f10a.png" class="img-fluid figure-img"></p>
<figcaption>Figure 10: EEA tile E35N25. On the left side PLOUGH 2015 in 20 m and on the right side, the PLOUGH 2017-2021. The orange (left) and the yellow (right) patch in the centre of the figures comes from the HIST-PLOUGH and therefore shows the outline of the 20 m pixel size at that time.</figcaption>
</figure>
</div>
<p>The introduction of the HER has caused inconsistency issues between the <strong>HER</strong>, <strong>GRA</strong> and the <strong>HISPLOUGH</strong>. Therefore, the <strong>HIS-PLOUGH</strong> product was adapted as the following: Class <em>0 - indication of ploughing in current year, former class 0 converted to class 253, class 100</em> will contain all pixel that change between two years due to changes in the <strong>HER</strong> but not ploughed to maintain consistency between <strong>PLOUGH</strong>, <strong>GRA</strong> and <strong>HER</strong> layers. Please refer to <strong>Error! Reference source not found</strong>. for a side-by-side view of the old and new class coding.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-b47d1af3225b944dbe9e4f0eab771936c27a02f9.png" class="img-fluid figure-img"></p>
<figcaption>Figure 11: Colour palette and attributes of PLOUGH layer. Left: HRL GRA 2015/2018 and right HRL VLCC.</figcaption>
</figure>
</div>
</section>
</section>
<section id="hrl-grasslands-mowing-layers" class="level2" data-number="3.4">
<h2 data-number="3.4" class="anchored" data-anchor-id="hrl-grasslands-mowing-layers"><span class="header-section-number">3.4</span> HRL Grasslands mowing layers</h2>
<p>I this section the methods and workflows for the production of the layers, <strong>Grassland Mowing Events (GRAME)</strong>, <strong>Grassland Mowing Dates (GRAMD)</strong> and the <strong>Grassland Mowing Events Confidence Layer (GRAMECL)</strong> are explained in more detail.</p>
<section id="input-data-2" class="level3" data-number="3.4.1">
<h3 data-number="3.4.1" class="anchored" data-anchor-id="input-data-2"><span class="header-section-number">3.4.1</span> Input data</h3>
<p>The main source of information for the <strong>Grassland Mowing (GRAM)</strong> layers are time series of high-resolution Sentinel-2 satellite data. Both processing Sentinel-2 processing levels Level-1C and Level 2A are used in the processing chain. Since undetected clouds and cloud shadows remain a significant drawback for the time-series analysis additional custom cloud masks are required. Sentinel-2 Level-1C product (providing Top-Of-Atmosphere reflectance images) serves as the primary input for the calculation of cloud masks. The Level-2A product (Bottom-OfAtmosphere reflectance as provided by WEkEO / ESA), serves as the primary input for the mowing detection via a time-series analysis. In addition to Sentinel-2 imagery, additional auxiliary data are needed:</p>
<ul>
<li><p><strong>CLMS High Resolution Vegetation Phenology and Productivity layer (HR-VPP):</strong> Startof-Season Date (SOSD) and End-of-Season Date (EOSD) (to calculate growing season parameters,</p></li>
<li><p><strong>CLMS HRL Herbaceous layer (HER)</strong> mask to perform the analysis only on the detected herbaceous area.</p></li>
</ul>
</section>
<section id="grassland-mowing-dates-gramd" class="level3" data-number="3.4.2">
<h3 data-number="3.4.2" class="anchored" data-anchor-id="grassland-mowing-dates-gramd"><span class="header-section-number">3.4.2</span> Grassland Mowing Dates (GRAMD)</h3>
<p>Based on a thorough analysis of available methodologies and experiences from CAP-based monitoring of mowing events, a methodology closely following the approach of Griffiths et al., 2020, was developed. Mowing events are determined by looking for disturbances (unusually sharp drops in biophysical signal) compared to a reference value. To determine the reference value, a reference time series model approximating the theoretical phenology of undisturbed grassland was developed. Griffiths et al.&nbsp;(2020) have shown that using an idealized phenological model as an upper envelope allows mowing events to be identified as deviations from the idealized model.</p>
<p>As opposed to Griffiths et al.&nbsp;(2020), who used a compositing technique to combine Sentinel-2 and Landsat 8 data into temporally equally spaced time series, we only use time series of the available cloud-free (pixelwise) Sentinel-2 images.</p>
<p>Another difference concerns the determination of the reference - the “idealized phenological model” - used for the calculation of the residuals, which are in turn used to detect the mowing events. Griffiths et al.&nbsp;(2020) developed an algorithm for selecting some points to be used to fit a third order polynomial. The result of the fit is then the reference used for the calculation of the residuals. Explorative studies conducted at the beginning of the test period yielded comparable results when selecting the points and using third order polynomials, and when simply using the entire time series and fitting second order polynomials to the data points. An adjustment to the threshold for the residuals that determine whether a mowing event has occurred was needed.</p>
<p>Examples of the algorithm results are shown in Figure 12 and Figure 13. The NDVI time series refer to single pixels within fields in the Sentinel-2 test tile 32TPT, for which we could obtain exact dates of the mowing events from reliable ground-truth data. Cloud and shadow masking is performed by combining Sen2Cor SCL and Cloudsen12 (Aybar et al.&nbsp;2022). As demonstrated by the plots, the observations are sufficiently dense and cloud/cloud shadow masking performed well, allowing for clear detection of most mowing events. Two false negatives are seen in both Figure 12 and Figure 13.</p>
<p>A high-level overview of the first part of the workflow that is deployed to derive an intermediate version of the mowing dates, event counts and confidence layers is presented in Figure 14.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-9a30382a1e822f8c20aba634c1b8b5fe39893347.png" class="img-fluid figure-img"></p>
<figcaption>Figure 12: Single-pixel NDVI time series and mowing events (ground truth and detected) for 2021 (32TPT; WGS84 coordinates: 11.3151°E, 47.5911°N).</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-6beb035041b6456fa36fcdababaf84705f920bdf.png" class="img-fluid figure-img"></p>
<figcaption>Figure 13: Single-pixel NDVI time series and mowing events (ground truth and detected) for 2021 (32TPT; WGS84 coordinates: 11.3103°E, 47.5884°N).</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-e3e2e358e2935abec94b3406f1fbcc86ad73801c.png" class="img-fluid figure-img"></p>
<figcaption>Figure 14: Processing workflow and pipeline for the GRAMD and GRAME layers part 1: Source data selection, pre-processing and cloud masking, and mowing event detection.</figcaption>
</figure>
</div>
<p>The mowing detection algorithm is season-based, meaning that a start and end of season are needed for the analysis of the time series. Extending the time window of the analysis beyond the true length of the growing season would result in a strong increase in false positive detections, while the consequence of using too short of a time window is the strong increase of false negatives (i.e., mowing events are not detected, being outside the analyzed time frame). The determination of the season length has been performed on Sentinel-2 tile basis, exploiting the HR-VPP layers (see section 3.3.1). By default, we use the 25th percentile of the start of season and the 75th percentile of the end of season of the herbaceous surfaces of the considered tile.</p>
<p>NDVI time-series are computed from the Sentinel-2 L2A, observations with clouds or shadows are removed, and the mowing event detection algorithm described above is applied within the determined vegetation season. The detection of mowing events is limited to a maximum of four events per season.</p>
<p>A high-level overview of the subsequent steps of the workflow is presented in Figure 15.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-303adab12940a2f66fe85851323e4e84adb79614.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Figure 15: Processing workflow and pipeline for the GRAMD and GRAME layers: reprojection, shift to yearly timeframes, mosaic, MMU filtering and data export.</figcaption>
</figure>
</div>
<p>While in most tiles the start and end of season are within a single year, some climatic areas can have a start of season in the previous year, combined with an early end of season. In those cases, the final product is derived by the combination of the season-based products, keeping only the dates within the year of interest.</p>
<p>Following the steps described above, the GRAMD layers in Sentinel-2 tiles are mosaicked to form EEA tiles. Furthermore, GDAL sieve is applied, aiming at reducing the unavoidable noise in the resulting raster due to fluctuations in time and space of the NDVI values. The minimum mapping unit of 0.25 ha from the product specifications corresponds to 25 pixels. The sieve filter is applied to the tile product with an extra buffer of 25 pixels, to avoid border effects at the tile boundaries, and the result is finally cropped back to the EEA tile extension. For known limitations of the spatial sieving on a multi-valued date laser please refer to section 3.4.5)</p>
<p>Summarizing, <strong>the following steps are needed to derive the GRAMD layers:</strong></p>
<ul>
<li><p>Determination of start and end of season using <strong>HR-VPP SOSD and EOSD</strong> layers, masked with HER layers.</p></li>
<li><p>Computation of cloud and shadow masks for dates within the growing season period.</p></li>
<li><p>Computation of NDVI for dates within the growing season period, and application of cloud and shadow mask.</p></li>
<li><p>Application of the mowing detection algorithm on herbaceous pixels (according to <strong>HER</strong> layer);</p></li>
<li><p>If applicable, re-grouping of mowing events, from season to year.</p></li>
<li><p>Application of the MMU of 25 pixels (0.25 ha);</p></li>
<li><p>Finalizing steps (creation of the Cloud-Optimized-GeoTiffs, color tables, metadata).</p></li>
</ul>
</section>
<section id="grassland-mowing-events-grame" class="level3" data-number="3.4.3">
<h3 data-number="3.4.3" class="anchored" data-anchor-id="grassland-mowing-events-grame"><span class="header-section-number">3.4.3</span> Grassland Mowing Events (GRAME)</h3>
<p>After the application of the sieve filter to the <strong>GRAMD</strong> layers, the <strong>GRAME</strong> layer is derived by counting non-zero events for each pixel.</p>
<p><strong>The following steps are needed to derive the GRAME layers:</strong></p>
<ul>
<li><p>Count of non-zero occurrences in the stack of <strong>GRAMD</strong> layers (pixelwise);</p></li>
<li><p>Finalizing steps (creation of the Cloud-Optimized-GeoTiffs, color tables, metadata)</p></li>
</ul>
</section>
<section id="grassland-mowing-event-confidence-layer-gramecl" class="level3" data-number="3.4.4">
<h3 data-number="3.4.4" class="anchored" data-anchor-id="grassland-mowing-event-confidence-layer-gramecl"><span class="header-section-number">3.4.4</span> Grassland Mowing Event Confidence Layer (GRAMECL)</h3>
<p>Long gaps in the time series reduce the capability of detecting mowing events (see also section <a href="#sec-Encountered-issues-and-known-limitations" class="quarto-xref">Section&nbsp;3.4.5</a>). The confidence layer provides an indication of the likelihood of not having missed a mowing event and combines it with the individual confidence of each of the detected events.</p>
<p>The <strong>Grassland Mowing Event Confidence Layer (GRAMECL)</strong> gives an estimate of the confidence that the occurrence of the false negative and false positive events is minimized. All the <strong>GRAMD</strong> layers and the <strong>GRAME</strong> layer are required to derive <strong>GRAMECL</strong>. The confidence is computed as</p>
<p><span class="math inline">\(\mathrm{GRAMECL} = 100 \times C_{\mathrm{FN}} \times C_{\mathrm{FP}}\)</span></p>
<p>where <span class="math inline">\(C_{FN}\)</span> and <span class="math inline">\(C_{FP}\)</span> are the confidences of minimizing the occurrence of the false negative and the false positive events, respectively. Both <span class="math inline">\(C_{FN}\)</span> and <span class="math inline">\(C_{FP}\)</span> are calculated in the range [0,1] (as detailed below), such that the final confidence is in the range <span class="math inline">\(G R A M E C L\ \in\ [0,100]\)</span>, with the highest value interpreted as the 100% probability that no true mowing event was missed and no false mowing event was incorrectly detected.</p>
<p>The confidence <span class="math inline">\(C_{FN}\)</span> is concerned with gaps in the pixelwise time series. These gaps arise either from the prolonged periods of cloudiness, or due to the intrinsic gap due to the Sentinel-2 revisit time (as high as 10-15 days in certain areas), and they can be responsible for missing mowing events (false negatives). This issue is addressed, and the definition for the confidence <span class="math inline">\(C_{FN}\)</span> is developed as follows. Supposing that a given pixel has <span class="math inline">\(N\)</span> available points in the time series, a probability that an event was missed between any two consecutive points is defined as:</p>
<p><span class="math display">\[
p_i =
\begin{cases}
\frac{\Delta t_i}{\Delta t_{\mathrm{max}}}, &amp; \Delta t_i \leq \Delta t_{\mathrm{max}} \\
1, &amp; \Delta t_i &gt; \Delta t_{\mathrm{max}}
\end{cases}
\]</span></p>
<p>Here, <span class="math inline">\(\Delta t_i\)</span> represents a time gap between the 𝑖-th and the <span class="math inline">\((i+1)\)</span>-th observation in the time series, and <span class="math inline">\(\Delta t_{max}\)</span> is a predefined tolerance window, in this case set to <span class="math inline">\(\Delta t_{max}=28\)</span> days. If the time interval between the two observations is smaller than <span class="math inline">\(\Delta t_{max}\)</span> according to this definition the probability that an event was missed increases linearly with the time gap <span class="math inline">\(\Delta t_i\)</span>. In case the interval between the two observations is larger than the predefined window, the probability of a missed event is assumed to be 1. The total probability that an event was missed is then obtained as a weighted average over all the time intervals <span class="math inline">\(\Delta t_i\)</span> (for <span class="math inline">\(i=1,...,N-1\)</span>), namely:</p>
<p><span class="math display">\[
P_{\mathrm{total}} = \sum_{i=1}^{N-1} p_i \left( \frac{\Delta t_i}{\Delta T} \right)
\]</span></p>
<p>Where <span class="math inline">\(\Delta T\)</span> is the total length of the time series (i.e., length of the growing season in days). The final confidence is obtained as <span class="math inline">\(C_{FN}=1-P_{total}\)</span>.</p>
<p>The confidence <span class="math inline">\(C_{FP}\)</span> is concerned with the imperfections in the cloud masking. Namely, events such as shadows, haze or thin clouds can be missed by the masking algorithm, and they can lead to incorrectly detected mowing events (false positives). This issue is addressed, and the definition for the confidence <span class="math inline">\(C_{FP}\)</span> is developed as follows. For a given pixel, all the mowing events detected within the <strong>GRAMD</strong> layers are iterated over. For an <span class="math inline">\(i\)</span>-th mowing event, image filtering is applied to its corresponding cloud mask, using an identity kernel. More specifically, a custom kernel (filter) is introduced as a normalized 2D identity array of the shape <span class="math inline">\(61 × 61\)</span>, thus defining a relevant area of +/- 30 pixels (300 m) around the pixel of interest. The result of the filtering is the percentage of clear pixels in the area defined by the kernel, <span class="math inline">\(P_{clear}^{(i)}\)</span>. The values of <span class="math inline">\(P_{clear}^{(i)} &lt; 1\)</span> indicate the proximity of the pixel to any nearby clouds, which in turn lowers the confidence that the pixel in question is a clear pixel, free from any cloud or shadow. In addition, we compute the tile-based percentage of thin clouds detected within the Sentinel-2 tile, <span class="math inline">\(P_{thin\:clouds}^{(i)}\)</span> (this information is straightforwardly computed from the generated Cloudsen12 cloud masks). The confidence that the <span class="math inline">\(i\)</span>-th mowing event is not a false positive is then obtained as</p>
<p><span class="math display">\[
{c^{(i)}}_{FP} = P_{\mathrm{clear}}^{(i)} \, \Big( 1 - P_{\mathrm{thin\ clouds}}^{(i)} \Big)
\]</span></p>
<p>The final confidence follows as the product over all single-day confidences, <span class="math inline">\(C_{FP} = \prod_{i=1}^{N_{\mathrm{events}}} c^{(i)}{}_{FP}\)</span></p>
</section>
<section id="sec-Encountered-issues-and-known-limitations" class="level3" data-number="3.4.5">
<h3 data-number="3.4.5" class="anchored" data-anchor-id="sec-Encountered-issues-and-known-limitations"><span class="header-section-number">3.4.5</span> Encountered issues and known limitations</h3>
<p>During the implementation and production of the <strong>GRAM</strong> layers some issues have been identified. These can be divided into several subgroups:</p>
<p><strong>MMU-related</strong></p>
<p>The requirement of a Minimum Mapping Unit for the <strong>GRAMD</strong> layers, albeit resulting in more uniform results, also yields some issues resulting from the need to apply a spatial filtering on complex layers presenting dates and counts.</p>
<ol type="1">
<li><p>The <strong>HER</strong> layer used for determining the areas where to apply the mowing detection algorithm does not have an MMU. It is therefore not possible to satisfy both the mapping of mowing events for all herbaceous pixels and the MMU of 0.25 ha of the <strong>GRAMD</strong>. As a result, the <strong>GRAMD</strong> still contains patches below the MMU in particular in small HER patches.</p></li>
<li><p>The GDAL sieve<a href="#fn10" class="footnote-ref" id="fnref10" role="doc-noteref"><sup>10</sup></a> filter needs to be applied independently to each of the four <strong>GRAMD</strong> layers. This filter ensures that patches of DOY-values smaller than the threshold of 0.25 ha (25 pixels) are replaced by the value of the largest neighboring patch, but only if the size of the neighboring patch is larger than the threshold. Since this filtering is applied individually to each <strong>GRAMD</strong> layer (<strong>GRAMD_1, GRAMD_2, …</strong>), in some cases, the newly assigned value is already present in one of the other mowing event date layers at the same location (i.e.&nbsp;the same pixels). In such cases, it results in date duplication, where timing of the first mowing event (<strong>GRAMD_1</strong>) and the second mowing event (<strong>GRAMD_2</strong>) share the same DOY. This occurs in approximately 0.4 % of the herbaceous pixels.</p></li>
<li><p>The independent filtering of the <strong>GRAMD</strong> layers explained in the previous point can also result in a fictitious increase in the mowing count of the <strong>GRAME</strong> layer. Furthermore, the MMU requirement cannot be guaranteed in the resulting <strong>GRAME</strong> layer, because the MMU-compliant patches in the single GRAMD layers could overlap in an “unfavorable” manner. On the other hand, not re-counting the events after sieving or applying a second filter on the GRAME would result in strong inconsistencies across the different layers.</p></li>
</ol>
<p><strong>Verification and quality control</strong></p>
<p>A quality assessment of the <strong>GRAM</strong> layer is very challenging due to lack of reliable and representative ground-truth data across Europe.</p>
<p><strong>Related EO input data</strong></p>
<p>Cloud cover can strongly reduce availability of usable data. This issue is dependent on the region, with an example of average cloudiness shown in Figure 16 (a). Sentinel-2 observation pattern and the associated swath borders lead to differences in the data availability in different regions, with some regions experiencing an average gap as high as 10-15 days (in combination with cloud coverage). The Sentinel-2 observation gaps are shown in Figure 16 (b). These gaps can result in noticeable border issues/data stripes in the <strong>GRAME</strong> product (see Figure 17).</p>
<p>In some case the atmospheric correction of the L2A also seems to be a cause of false positive mowing detection. Further investigations in this regard will be needed.</p>
<p><strong>Cross-year season</strong></p>
<p>For some tiles with an early start of the vegetation period, the mowing season associated with a reference year may begin in the previous calendar year. Likewise, the subsequent season, which for the next year, may already start within a given reference year. Since the production of the VLCC products (incl.&nbsp;the GRAM) has been conducted in several phases (2017-2021, 2022-2023, 2024) this can result in incomplete detection of mowing events for the final year in the production interval, as data from the following season is not yet processed. To ensure consistency and completeness, it may be necessary to include an additional year of data for tiles with early season starts and for the final year of the production interval.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-cc948934135584de49fbd4cb942740dcde2e9c17.png" class="img-fluid figure-img"></p>
<figcaption>Figure 16: Sentinel-2A and - 2B L1C data coverage in 2018. Shown are (a) average cloudiness, and (b) average gap between cloud-free observations.</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-321da7a884def72c625e69183efbbe9654e38607.png" class="img-fluid figure-img"></p>
<figcaption>Figure 17: Visibility of the Sentinel-2 swath borders and the different swath coverage in the GRAME layer (32TPT; WGS84 coordinates: 10.63480°E, 47.65318°N).</figcaption>
</figure>
</div>
</section>
</section>
<section id="hrl-crop-type" class="level2" data-number="3.5">
<h2 data-number="3.5" class="anchored" data-anchor-id="hrl-crop-type"><span class="header-section-number">3.5</span> HRL Crop Type</h2>
<p>This section gives an overview of the methodology employed to produce the layers Crop Type (CTY) and the Crop Type Confidence Layer (CTYCL).</p>
<section id="input-data-3" class="level3" data-number="3.5.1">
<h3 data-number="3.5.1" class="anchored" data-anchor-id="input-data-3"><span class="header-section-number">3.5.1</span> Input data</h3>
<p>Before the pixel-based inputs are fed to the model, minimal pre-processing is applied to transform the raw inputs to a consistent format. Optical Sentinel-2 data is first cloud-masked based on the official L2A scene classification value to which an erosion-dilation process is applied to enhance the cloud/shadow mask. Next, a 10-day compositing window is applied where the median operator is used if multiple observations are available. Finally, any remaining missing values are linearly interpolated to prevent gaps in the input data, as the presence of ‘no data’ values can lead to model instability. The 20m optical bands are resampled to 10m resolution by applying a nearest neighbour interpolation.</p>
<p>Sentinel-1 backscatter is derived from Level-1 GRD (Ground Range Detected) products, which have been pre-processed to correct for geometric distortions. To obtain meaningful surface backscatter values, sigma nought backscatter is calculated from these GRD products using the ellipsoidal Earth model. For enhanced accuracy, the Copernicus 30 m Digital Elevation Model (DEM) is also applied to support radiometric correction, compensating for terrain effects and ensuring consistent backscatter values across varying landscapes. By default, only one orbit direction (Descending) is kept, as the model is designed to handle a single Sentinel-1 orbit pass. Combining ascending and descending orbits could mix signals acquired under different viewing geometries, potentially leading to a loss of relevant information. Additionally, using both orbits would significantly increase processing costs without a clear benefit for model performance. The available observations are composited with the 10-day windows where multiple acquisitions are averaged. Any rare missing values are linearly interpolated. Finally, the backscatter intensity values are converted to decibel values. If there is insufficient Descending data (data gaps &gt; 10 days, especially happened over northern Europe) also Ascending data is used.</p>
<p>The Copernicus 30m DEM is used to derive altitude and slope at the pixel level, for which resampling to the Sentinel-2 10m grid is performed. Finally, the daily mean temperature variable is extracted from the original AgERA5 meteorological data, aggregated into 10-day intervals, and resampled to the Sentinel-2 10 m grid.</p>
</section>
<section id="classification-algorithm-and-inference" class="level3" data-number="3.5.2">
<h3 data-number="3.5.2" class="anchored" data-anchor-id="classification-algorithm-and-inference"><span class="header-section-number">3.5.2</span> Classification algorithm and inference</h3>
<p>The classification algorithm consists of a transformer-based feature extractor followed by a downstream crop classification head (Vaswani et al., 2017; Zerveas et al., 2021) (Figure 18). These two parts are coupled into one model which is trained end-to-end based on the available training data. Input to the model are the aligned inputs from the source-specific preprocessing steps. Time series from optical Sentinel-2 bands (“B02”, “B03”, “B04”, “B05”, “B06”, “B07”, “B08”, “B11”, “B12”) and radar Sentinel-1 backscatter (VH and VV) are jointly fed into a transformer-based encoder, which is designed to automatically extract the most relevant features for crop type classification. To better align similar inputs from different regions in Europe, the encoder model simultaneously has access to the temperature time series data in order to better differentiate the observed satellite time series across varying meteorological conditions. The transformer architecture contains an attention mechanism that learns to extract relevant information within and across the different input data streams. The original optical Sentinel-2 bands, radar Sentinel1 backscatter intensities, and meteorological time series are directly fed into the transformer encoder for automated feature extraction. Inputs that lack a temporal dimension are fed as scalars to a dense encoder for simple feature extraction. The output of the feature extractor (encoder) part represents a highly condensed and informative representation of the inputs and because the model is trained in a fully-supervised manner, the extracted features are already finetuned towards a crop classification task. Traditional manual feature engineering is hence not needed in this setup.</p>
<p>Once the features (embeddings) have been extracted, explicit fusion of the different inputs happens by concatenating these features before feeding them to a multi-layer perceptron classification head consisting of several stacked dense layers. Final output of the classification head is a probability of an input belonging to a crop type label, with probabilities of all labels summing to one. Final classification is performed by assigning to each 10m pixel from the 19 crop type classes the label that has the highest probability.</p>
<p>The model was trained on an extensive in-situ dataset of almost one million samples compiled from LPIS-GSA, LUCAS datasets and active learning sampling (Table 3) (Eurostat, 2018). The original LPIS-GSA and LUCAS datasets have each been fully harmonised towards a common crop type nomenclature (available for download, <a href="https://artifactory.vgt.vito.be/artifactory/auxdata-public/worldcereal/legend/WorldCereal_LC_CT_legend_latest.csv">here</a>). The harmonized version of each dataset, along with the harmonization procedure and the translation of original crop type labels to harmonized labels, have all been published on the <a href="https://rdm.esa-worldcereal.org/">WorldCereal Reference Data Module</a> (RDM) and are available for anyone to use. More general information about this harmonization procedure and on how to navigate the WorldCereal RDM application, is available on the <a href="https://worldcereal.github.io/worldcereal-documentation/rdm/overview.html">WorldCereal documentation portal</a>. In a next step, each individual dataset has been subsampled to derive a representative training dataset at European scale, avoiding as much as possible spatial and temporal bias and ensuring a label-balanced training dataset. This subsampling was done in an iterative way for each dataset separately:</p>
<ol type="1">
<li><p>A fully random sample was drawn across all crop types available in the dataset. The initial sample size was chosen dynamically per dataset depending on the dataset’s spatial extent and the number of years available for the region. This first random step ensured the most dominant crop types for the region were sufficiently represented. Only grassland was ignored during this initial stage, to avoid massive bias towards this dominant land cover class.</p></li>
<li><p>On top of the initial random sampling stage, we identified a number of “focus crops” for which we ensured a minimum number of samples taken from the dataset. Focus crops were defined as the target crops to be included in the eventual pan-European crop type maps. In case of cereals, the most dominant cereal types (wheat, barley, rye, oats, triticale) were sampled separately. Again, the minimum number of crop-specific samples were defined dynamically per dataset, depending on its spatial and temporal extent.</p></li>
<li><p>Depending on early model iterations and testing, additional samples for targeted crop types in targeted regions were dynamically added to the training dataset. This for instance included additional wheat and barley data in Southern Europe.</p></li>
</ol>
<p>Finally, all training data was merged into a final representative training dataset, which was used to train a single model that generalizes well across all regions and can be reused for crop classification on a yearly basis.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-30f252232ca825a8c65e2f9d4607446160de7470.png" class="img-fluid figure-img"></p>
<figcaption>Figure 18: Schematic overview of the crop type model architecture</figcaption>
</figure>
</div>
<p>Table 3: Overview of the used training points per dataset and year for the CTY model training</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Country/Region</th>
<th>Years</th>
<th>Number training points</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Austria (LPIS/GSA)</td>
<td>2018, 2019, 2020</td>
<td>160 174</td>
</tr>
<tr class="even">
<td>Germany (LPIS/GSA)</td>
<td>2021</td>
<td>77031</td>
</tr>
<tr class="odd">
<td>Denmark (LPIS/GSA)</td>
<td>2019</td>
<td>39596</td>
</tr>
<tr class="even">
<td>Estonia (LPIS/GSA)</td>
<td>2021</td>
<td>16874</td>
</tr>
<tr class="odd">
<td>Spain (LPIS/GSA)</td>
<td>2019, 2020, 2021</td>
<td>133 830</td>
</tr>
<tr class="even">
<td>Finland (LPIS/GSA)</td>
<td>2021</td>
<td>28138</td>
</tr>
<tr class="odd">
<td>Belgium (LPIS/GSA)</td>
<td>2018, 2019, 2020, 2021</td>
<td>52938</td>
</tr>
<tr class="even">
<td>France (LPIS/GSA)</td>
<td>2019, 2020</td>
<td>108 158</td>
</tr>
<tr class="odd">
<td>Croatia (LPIS/GSA)</td>
<td>2020</td>
<td>12111</td>
</tr>
<tr class="even">
<td>Lithuania (LPIS/GSA)</td>
<td>2021</td>
<td>26243</td>
</tr>
<tr class="odd">
<td>Latvia (LPIS/GSA)</td>
<td>2021</td>
<td>42226</td>
</tr>
<tr class="even">
<td>Sweden (LPIS/GSA)</td>
<td>2021</td>
<td>36374</td>
</tr>
<tr class="odd">
<td>Slovakia (LPIS/GSA)</td>
<td>2021</td>
<td>46609</td>
</tr>
<tr class="even">
<td>Europe (LUCAS)</td>
<td>2018</td>
<td>26294</td>
</tr>
<tr class="odd">
<td>Europe (Active learning)</td>
<td>2019, 2020, 2021</td>
<td>17196</td>
</tr>
</tbody>
</table>
<p>The trained model is deployed as part of an OpenEO<a href="#fn11" class="footnote-ref" id="fnref11" role="doc-noteref"><sup>11</sup></a> workflow that covers in an end-to-end way the cloud-based access to the required algorithm inputs, preprocessing steps as described above, model inference, and writing of the output product. Parallelisation is done automatically after tuning the necessary parameters such as the height and width of individual processing windows. The CTY processing is based on 20km LAEA sub-tiles of the original LAEA 100km grid.</p>
</section>
<section id="post-processing" class="level3" data-number="3.5.3">
<h3 data-number="3.5.3" class="anchored" data-anchor-id="post-processing"><span class="header-section-number">3.5.3</span> Post-processing</h3>
<p>In the postprocessing pipeline (Figure 19 &amp; Figure 20), each 20km LAEA sub-tile is postprocessed independently, except for the temporal rule-based postprocessing and the tile padding for GDAL Sieve steps. First, the cropland layer derived from <strong>BVL</strong> (classes ‘Annual arable cropland and perennial (permanent) crops’, ‘Tree crops’ and ‘Overlap herbaceous–Tree cover’) is applied as a basic mask, setting non-cropland pixels as well as out of scope zones. In that step, a correction is also performed for pixels which are classified as grass and fodder by the crop type model but for which the <strong>BVL</strong> considers them as permanent crops. In that case, the pixels crop types are changed to the permanent crop class with the highest probability. Then, remaining cropland pixels are reclassified by performing spatial smoothing with a gaussian kernel (3x3) on every perclass probability and re-assign the pixel’s class from the new highest probability. This allows to improve class consistency within fields, as the crop type classifier is pixel-based. The result of this process gives the intermediate crop type with grass/fodder crops included that is transferred to the herbaceous layer. The grass/fodder crops locations are removed from the crop type product for the next steps.</p>
<p>Afterwards, an interannual consistency correction is applied on the full time series (2017-2021). Products on the same location but for different years are concatenated together before running the correction. The following three cases are covered:</p>
<ul>
<li><p>When a sequence of crop types consists of only permanent crops, except for one year (that is not in the edges) then corrects that sequence to the permanent crop class that has the maximum accumulated probability over the sequence. Cases from the edge years are excluded as they may indicate transitions between arable and permanent crop states. Thus, sufficient data is lacking to make reliable assumptions.</p></li>
<li><p>When a full sequence (including edge years) of permanent crops does not have the same crop type, then sets that sequence with the permanent class that has the maximum accumulated probability over the sequence. This operation helps by having a more consistent prediction in permanent crop cases.</p></li>
<li><p>When a pixel of permanent crop class is in-between two arable years, which could correspond to (temporarily) fallow conditions, this pixel is set to the background class (0). For the same reasons as described in the first point, the edge years are not modified by this operation.</p></li>
</ul>
<p>Grass and fodder classes are ignored in interannual consistency corrections and are treated as the background class. In addition, pixels that do not correspond to cropland for all the years of the analysis are ignored, as again the information is insufficient to make assumptions.</p>
<p>Thereafter, pixels where the maximum probability of all predicted classes is below 25% are set either to unclassified arable cropland or undecided permanent crop, dependent to which category the class with the highest probability belongs.</p>
<p>Isolated pixels and small fields are finally cleaned using the GDAL Sieve operation with a MMU of 0.25 ha and connectivity 4. In addition to obtain more consistent land cover maps, this operation also ensures a minimum mapping unit of 0.25ha for each field. To avoid artefacts at the boundaries between tiles, a padding must be added to each sub-tile before running the spatial cleaning. Once the padding is performed, the GDAL Sieve operation replaces every field with an area below the threshold of 0.25ha by changing the class to the class of the neighbour field with the largest area, including the background class (0) in the calculation to remove small, isolated fields. Pixels that were excluded by previous operations remain excluded after GDAL Sieve.</p>
<p>Finally, 20km sub-tiles are combined in larger tiles to obtain the final 100km crop-type and probability products.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-78c38c35d79557f1150fa0e6918cd84024ca4f22.png" class="img-fluid figure-img"></p>
<figcaption>Figure 19: CTY postprocessing pipeline flowchart</figcaption>
</figure>
</div>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-b752ff52dd8f50223ebe874203e33a0c3406029f.png" class="img-fluid figure-img" style="width:50.0%"></p>
<figcaption>Figure 20: Decision tree of the CTY postprocessing pipeline, outlining the main steps from raw crop type probabilities to final output classes. For clarity, output categories are simplified to ‘permanent’ and ‘annual’ cropland, as the decision rules were specifically designed for these classes. Note that spatial operations (defined in Figure 19) such as spatial smoothing and GDAL Sieve, although they may further modify crop type labels, are not included in this diagram to maintain readability</figcaption>
</figure>
</div>
</section>
<section id="crop-type-confidence-layer" class="level3" data-number="3.5.4">
<h3 data-number="3.5.4" class="anchored" data-anchor-id="crop-type-confidence-layer"><span class="header-section-number">3.5.4</span> Crop Type Confidence Layer</h3>
<p>The Crop Type Confidence Layer (CTYCL) provides a per-pixel estimate of the classification confidence by reporting the final probability associated with the selected crop type label at 10-meter resolution. This probability originates from the crop type classification model output, where each crop class is assigned a confidence value. However, the final probability values may be modified during the crop type postprocessing chain, which ensures spatial and temporal consistency. Specifically, the following chronological steps can influence the confidence values:</p>
<ul>
<li><p>Spatial smoothing: A 3×3 Gaussian filter is applied to the per-class probability output, enhancing spatial coherence across neighbouring pixels. Pixel classes are re-assigned based on the updated highest probability, which may differ from the original model output.</p></li>
<li><p>Interannual consistency correction (see also above): When a permanent crop is missing (excluding edge years) in a single year of an otherwise consistent time series, or when the sequence includes different permanent crop types, the final crop type class will be adjusted. In these cases, the pixel’s confidence value is recalculated as the average probability of the selected permanent crop class across the time series.</p></li>
<li><p>GDAL Sieve operation: To remove small, isolated patches, pixel values are reassigned based on the dominant neighbouring class. If a pixel’s class is changed during this step, its probability is updated to reflect the confidence of the newly assigned class.</p></li>
</ul>
<p>Pixels that are reassigned to the background class during postprocessing steps are assigned the “no cropland” confidence value of 253.</p>
</section>
<section id="encountered-issues-and-know-limitations" class="level3" data-number="3.5.5">
<h3 data-number="3.5.5" class="anchored" data-anchor-id="encountered-issues-and-know-limitations"><span class="header-section-number">3.5.5</span> Encountered issues and know limitations</h3>
<p>During the quality assurance process, minor <strong>violations of the minimum mapping unit (MMU)</strong> requirement were detected in non-cropland areas of the crop type layer (2017-2021).Specifically, the issue arose due to the GDAL Sieve operation being applied in a single pass. While a single pass may suffice for layers with a limited number of classes, it is not adequate when more than four distinct classes are present. In such cases, multiple sieving iterations are necessary to fully enforce the MMU constraint.</p>
<p>Although the original implementation included checks to address this limitation, non-cropland pixels were unintentional excluded from these checks. As a result, small patches of non-cropland remained below the MMU threshold. The overall impact of this issue is minimal, affecting approximately 0.0002% of the total crop type pixels.</p>
<p>Despite the application of postprocessing steps aimed at improving consistency, some <strong>implausible crop type sequences</strong> remain in the final crop type product (2017-2021). These arise from the inherent trade-off between enforcing temporal and spatial consistency. Interannual consistency checks promote temporal stability across years, while spatial consistency is enhanced using the GDAL Sieve operation. However, strictly enforcing both constraints would result in overly homogeneous patches, undermining the high-resolution detail offered by the 10-meter product.</p>
<p>This challenge is particularly pronounced in heterogeneous and complex landscapes such as those found in southern Europe, including agroforestry systems like Dehesa. In such regions, mixed sequences of permanent and annual crops may still appear, even if they are agronomically unlikely.</p>
<p>Additionally, the presence of the no-cropland class (label 0) within a sequence can be explained by various factors. These include the removal of grass/fodder pixels during postprocessing, reclassification through interannual consistency checks, or changes introduced by the GDAL Sieve operation. Such instances result in discontinuities within the crop type sequences.</p>
<p>Finally, the limited five-year time span of the dataset may not be sufficient to fully identify and correct all implausible sequences. Future observations beyond this period could help to better identify consistent crop type sequences and further reduce inconsistencies.</p>
</section>
</section>
<section id="hrl-cropping-pattern" class="level2" data-number="3.6">
<h2 data-number="3.6" class="anchored" data-anchor-id="hrl-cropping-pattern"><span class="header-section-number">3.6</span> HRL Cropping Pattern</h2>
<p>This section gives an overview of the methodology employed to produce the <strong>Cropping Patterns (CP)</strong> layers which includes a comprehensive of layers that provide details on the timing and extent of agricultural practices along five thematic groups being Main crops, Bare soil, Secondary crops, Fallow land and Cropping Seasons.</p>
<section id="input-data-4" class="level3" data-number="3.6.1">
<h3 data-number="3.6.1" class="anchored" data-anchor-id="input-data-4"><span class="header-section-number">3.6.1</span> Input data</h3>
<p>The <strong>HRL Cropping Patterns (CP)</strong> layers entail a wide set of layers relying on both Sentinel-2 optical and Sentinel-1 SAR-based satellite data. The <strong>HRL CTY</strong> layer is used to define the focus locations of the <strong>CP</strong> layers generation.</p>
<p>Sentinel-2 and Sentinel-1 backscatter data are pre-processed in a similar way as for the <strong>CTY</strong> layer, with some minor differences. In case of Sentinel-2 only a subset of relevant bands is retained, including band 2,3,4,8, 11 and the incident angles information. The latter is needed to derive fraction of Absorbed Photosynthetic Active Radiation (fAPAR) at 10m.</p>
<p>For the Sentinel-1 backscatter both the ascending and descending orbits information are combined to ensure maximum data availability required for detecting abrupt events like field harvest. Extraction of the data is done at field level, resulting in timeseries per field. Field boundaries are defined using a delineation algorithm.</p>
</section>
<section id="product-structure" class="level3" data-number="3.6.2">
<h3 data-number="3.6.2" class="anchored" data-anchor-id="product-structure"><span class="header-section-number">3.6.2</span> Product structure</h3>
<p>The <strong>CP</strong> portfolio compromises a diverse range of layers, derived from field level seasonal information. The methodology used to obtain field level seasonal information and derived cropping pattern layers is shown in Figure 21. In a first step, the locations for which CP layers are derived are filtered, i.e., only fields that are delineated and are dominantly covered by an annual crop are retained. The field delineations are obtained by using a 3D Res-UNet field delineation algorithm which uses Sentinel-2 images. Only fields above the MMU of 0.25 ha and which are classified as an annual crop by the <strong>CTY</strong> layer are retained. For this subset of delineated fields, Sentinel-1, and Sentinel-2 timeseries are retrieved, which are necessary inputs for the harvest and emergence detection. The detected harvest and emergence events are used to derive a maximum of two growing seasons per year based on expert rules. The workflow results in several CP layers, which are subdivided into 5 thematic themes:</p>
<ul>
<li><p><strong>Main crops</strong></p></li>
<li><p><strong>Bare soil</strong></p></li>
<li><p><strong>Secondary crops</strong></p></li>
<li><p><strong>Fallow land</strong></p></li>
<li><p><strong>Cropping Seasons</strong></p></li>
</ul>
<p>All vector-based <strong>CP</strong> layers are rasterized to 10 m spatial resolution to align with <strong>HRL CTY</strong> layer. Although the original <strong>CP</strong> layers are derived exclusively from delineated parcels larger than the defined MMU of 0.25 ha, a final spatial alignment with the <strong>HRL CTY</strong> layer is required to ensure consistency across product layers. This alignment step involves clipping the field-based <strong>CP</strong> outputs to the <strong>CTY</strong>-classified (pixel-based) annual cropland extent. As a result, some <strong>CP</strong> outputs—originally MMU-compliant—may appear as smaller spatial fragments due to partial overlap at field boundaries. While this may produce local patterns below the MMU threshold, these are a by-product of spatial alignment rather than the initial <strong>CP</strong> derivation. Reapplying a sieving operation at this stage to enforce the MMU would risk removing valid and relevant <strong>CP</strong> information, particularly in transitional or fragmented agricultural landscapes. Moreover, the clipping step alone already leads to some loss of <strong>CP</strong> content, and further filtering would compound this loss.</p>
<p>In the following sections, the methods used to delineate growing season(s) and derive the corresponding <strong>CP</strong> layers are described.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-5aebd0eb11363c76ebc7b03745474b57189972ca.png" class="img-fluid figure-img"></p>
<figcaption>Figure 21: Schematic overview of cropping pattern products generation.</figcaption>
</figure>
</div>
</section>
<section id="growing-season-delineation" class="level3" data-number="3.6.3">
<h3 data-number="3.6.3" class="anchored" data-anchor-id="growing-season-delineation"><span class="header-section-number">3.6.3</span> Growing season delineation</h3>
<p>The growing season delineation at field level forms the basis for the <strong>CP</strong> layers generation. The methodology used to determine the growing season delineation is shown in Figure 22. The onset and end of the season is based on the detected emergence and harvest events (see sections below), respectively. The detected emergence and harvest events are used in expert rules to determine the growing seasons (see sections below).</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-7ada907705c4edf3e61d95d290fbdd4b8e17b4df.png" class="img-fluid figure-img"></p>
<figcaption>Figure 22: Schematic overview of the growing season delineation.</figcaption>
</figure>
</div>
<section id="emergence-detection" class="level4" data-number="3.6.3.1">
<h4 data-number="3.6.3.1" class="anchored" data-anchor-id="emergence-detection"><span class="header-section-number">3.6.3.1</span> Emergence detection</h4>
<p>The inflection behavior of the spectral signal around the moment of emergence is used to detect emergence events. As spectral signal, daily fAPAR values obtained from the CropSAR technology are used. CropSAR is a deep learning method that allows to fill-in the cloud gaps in fAPAR timeseries using the relationship between Sentinel-2 fAPAR and Sentinel-1 backscatter data (CropSAR, 2024; Piccard et al., 2023). Optical fAPAR data were preferred to Sentinel-1 derived features since fAPAR is not influenced by soil structure and moisture content around emergence (Khabbazan et al, 2019). Additionally, the change of fAPAR around the emergence period is quite gradual. A rule-based approach was used to determine emergence events as deep learning methods depend on a substantial amount of training which were not available.</p>
<p>Field data on emergence dates (+- 200) of agricultural fields, located mainly in Belgium, were used to investigate the behavior of the fAPAR signal around emergence. From this, generalizable rules and threshold could be defined to allow a robust and consistent emergence detection as shown on Figure 23. The values of the parameters are obtained by applying a Monte Carlo simulation. Emergence is detected shortly after the occurrence of a slope inflection of the CropSAR timeseries (Figure 23), this is also confirmed in literature (Gao et al., 2017; Gao et al., 2021). Some additional parameters are used to check if the slope inflection is related with a clear seasonal signal (i.e., amplitude, duration until season peak, …). Within the literature it is also clearly confirmed that emergence typically occur after an inflection of the time series from optical derived data (Gao et al., 2017; Gao et al., 2021). The detected emergence date corresponds with the unfolding of the first leaves of the crop on the field.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-0b015b66e7689d69b6db9b63a616bcca4a767ec0.png" class="img-fluid figure-img"></p>
<figcaption>Figure 23: Different parameters selected for detecting an emergence event out of a seasonal profile.</figcaption>
</figure>
</div>
</section>
<section id="harvest-detection" class="level4" data-number="3.6.3.2">
<h4 data-number="3.6.3.2" class="anchored" data-anchor-id="harvest-detection"><span class="header-section-number">3.6.3.2</span> Harvest detection</h4>
<p>Harvest is defined as the moment of total removal of standing biomass from the field. For the harvest detection, a sequential neural network is trained to identify a harvest event out of set of selected satellite derived features. 600 fields with information on harvest date (both on the main season and for some on the secondary season) are used for model training. Most of these fields are in Belgium, Italy, Greece, and Austria and cover a wide range of the most common cultivated crops. The model is trained such that a detection of a harvest event aligns with the agreed definition on harvest. The following spectral features are used in the harvest detection algorithm:</p>
<ul>
<li><p>fAPAR (CropSAR)</p></li>
<li><p>Sentinel-2 Normalized Burnt Ratio 2 (NBR2) (Alcaras et al., 2022)</p></li>
<li><p>VH/VV in decibels derived from Sentinel-1 backscatter.</p></li>
</ul>
<p>The selected features complement each other. The VH/VV ratio does respond more to the structural changes of the field at harvest, while the other two features do react more on the biophysical change (Meroni et al., 2021; Van Tricht et al., 2018). The NBR2 is added as it is particularly sensitive for harvest at low fAPAR values. This typically occurs in cover crops or maize that are in a far stage of senescence at harvest. In such case, the fAPAR signal is not enough to properly detect a harvest event and the signal received from VH/VV is not that clear anymore due to the collapse (loss of structure) of the crop. All the different features are brought on a 6-daily temporal scale, in case of the NBR2 a Whittaker smoother has been applied to fill-in the cloud induced gaps. Gaps in Sentinel-1 VH/VV are linearly interpolated. The 6-daily time series of CropSAR, NBR2 and VH/VV are used in the harvest detection sequential neural network model.</p>
</section>
<section id="sec-Season-delineation" class="level4" data-number="3.6.3.3">
<h4 data-number="3.6.3.3" class="anchored" data-anchor-id="sec-Season-delineation"><span class="header-section-number">3.6.3.3</span> Season delineation</h4>
<p>For the season delineation, all the emergence and harvest events in a period of 6 months before and after the reference year of interest are retained. This six-month period is added to also be able to detect seasonalities that do not fall within the year boundaries (e.g., secondary crops and winter cereals). In the first step, the emergence and harvest detections are cleaned and associated with a single seasonality to categorize it as either a main or secondary season. A series of expert rules, derived from an examination of seasonal boundaries at the European level in conjunction with United States Department of Agriculture (USDA) crop calendar data, are used for labeling the seasons (see Table 4). These rules are fully independent from the <strong>CTY</strong> crop labels to avoid error propagation. For both main and secondary crops, some further sub-seasonality labelling is done to differentiate between winter &amp; spring crops and secondary crops growing before or after the main growing season of that reference year. Each of these sub-seasonality categories have different periods in which they can occur (Table 4). The sub-seasonality categorization can further assist in prioritizing the final selection of the labelled seasons as main or secondary season if multiple seasons conflict within one of these categories.</p>
<p>Additionally, also regional dependent seasonal bounds are defined due to different growing season periods within Europe. Therefore, Europe has been divided into two zones based on the Metzger environmental zones, which is based on variations in climatic conditions across the continent, for seasonal labeling (Metzger et al.&nbsp;2018). The translation of the original environmental zones into the two zones is shown in Table 5. The subdivision is mainly dividing more temperate/cold climates from warm/Mediterranean climates within the European continent. In the latter, onset of the main growing season is substantially earlier compared to the colder climates where temperature delays the season onset.</p>
<p>The expert rules for season labelling are described below:</p>
<ul>
<li><p>Emergence and harvest are chronologically linked together into a season.</p></li>
<li><p>A season that ends before the start of the reference year or starts after the end of that year, is removed.</p></li>
<li><p>Seasons with a length below 40 days or above 365 days are removed.</p></li>
<li><p>The remaining seasons are labelled into one of the following options (based on the defined limits in Table 4):</p>
<ul>
<li><p>Spring crop</p></li>
<li><p>Winter crop</p></li>
<li><p>Secondary crop before the main season</p></li>
<li><p>Secondary crop after the main season</p></li>
<li><p>No labelling possible (if it does not fit to one of the above categories)</p></li>
</ul></li>
<li><p>If a season falls in the seasonal limits of two types of sub-seasons, the following labelling priority is given:</p>
<ul>
<li><p>Overlap between winter and spring crop season:</p>
<ul>
<li><p>Days overlap season in spring crop season period &gt; days overlap in winter season period → spring crop.</p></li>
<li><p>Days overlap season in spring crop season period = days overlap in winter season period → spring crop.</p></li>
<li><p>Days overlap season in spring crop season period &lt; days overlap in winter season period → winter crop.</p></li>
</ul></li>
<li><p>Overlap between spring crop and secondary crop after main season → spring crop.</p></li>
</ul></li>
<li><p>Eventually, the final seasons used for generating the layers on main and secondary crops are defined as follows if there is a conflict (multiple occurrences) in one of these categories:</p>
<ul>
<li><p>Main season:</p>
<ul>
<li><span data-custom-style="NormalLine">Spring crop season &gt; winter crop season</span><br>
</li>
</ul></li>
<li><p>Secondary cover crop season:</p>
<ul>
<li><span data-custom-style="NormalLine">After the main season &gt; before the main season</span><br>
</li>
</ul></li>
</ul></li>
</ul>
<p>If no main season is detected for a specific field in a certain reference year also no secondary crop season information is provided.</p>
<p>Table 4: Expert rules with seasonal limits for season delineation based on emergence and harvest input.</p>
<table class="caption-top table">
<colgroup>
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
<col style="width: 20%">
</colgroup>
<thead>
<tr class="header">
<th>Type season</th>
<th>Zone</th>
<th>Sub-seasonality</th>
<th>Emergence period</th>
<th>Harvest period</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Main season</td>
<td>1</td>
<td>Winter crop</td>
<td>15/08(year-1)→ 30/04(())</td>
<td>01/(06_{()}) → 15 (;/09_{(r)})</td>
</tr>
<tr class="even">
<td>Main season</td>
<td>1</td>
<td>Spring crop</td>
<td>(01/04_{(}/07_{(})</td>
<td>(01/07_{()}/1)(1/12_{(})</td>
</tr>
<tr class="odd">
<td>Main season</td>
<td>2</td>
<td>Winter crop</td>
<td>15 (/08_{()}/03_{(})</td>
<td>(01/04_{(}/08_{(})</td>
</tr>
<tr class="even">
<td>Main season</td>
<td>2</td>
<td>Spring crop</td>
<td>01/(03_{()}/07_{()})</td>
<td>(01/06_{(}-)()/01((1))</td>
</tr>
<tr class="odd">
<td>Secondary season</td>
<td>1</td>
<td>Before main season</td>
<td>01/01 (.()))→ (30/04_{()}))</td>
<td>01/01 (.()))→ (30/04_{()}))</td>
</tr>
<tr class="even">
<td>Secondary season</td>
<td>1</td>
<td>After main season</td>
<td>1 (.5.)/0 (7_{()}))→ (30/04_{(}))</td>
<td>1 (.5.)/0 (7_{()}))→ (30/04_{(}))</td>
</tr>
<tr class="odd">
<td>Secondary season</td>
<td>2</td>
<td>Before main season</td>
<td>(01/01_{()})(/03_{(y e a r)})</td>
<td>(01/01_{()})(/03_{(y e a r)})</td>
</tr>
<tr class="even">
<td>Secondary season</td>
<td>2</td>
<td>After main season</td>
<td>1 (5/06_{()}/03_{(+1)})</td>
<td>1 (5/06_{()}/03_{(+1)})</td>
</tr>
</tbody>
</table>
<p>Table 5: Translation of Metzger environmental zones into a zone used with the same season delineation limits.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th>Environmental zone (Metzger)</th>
<th>Zone</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Alpine north</td>
<td>1</td>
</tr>
<tr class="even">
<td>Boreal</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Nemoral</td>
<td>1</td>
</tr>
<tr class="even">
<td>Atlantic north</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Atlantic south</td>
<td>1</td>
</tr>
<tr class="even">
<td>Continental</td>
<td>1</td>
</tr>
<tr class="odd">
<td>Atlantic central</td>
<td>1</td>
</tr>
<tr class="even">
<td>Pannonian</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Lusitanian</td>
<td>2</td>
</tr>
<tr class="even">
<td>Anatolian</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Mediterranean mountains</td>
<td>2</td>
</tr>
<tr class="even">
<td>Mediterranean north</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Mediterranean south</td>
<td>2</td>
</tr>
<tr class="even">
<td>Macaronesia</td>
<td>2</td>
</tr>
<tr class="odd">
<td>Arctic</td>
<td>1</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="confidence-layers" class="level3" data-number="3.6.4">
<h3 data-number="3.6.4" class="anchored" data-anchor-id="confidence-layers"><span class="header-section-number">3.6.4</span> Confidence layers</h3>
<p>For most of the CP layers confidence information is provided and is based on the uncertainty of the emergence and harvest detection used to delineate the growing season(s). This confidence is calculated based on the uncertainty of satellite observations at the date of emergence or harvest. The CropSAR technology used to fill-in cloud induced gaps of fAPAR provides this uncertainty interval of fAPAR at these dates, as the (10^{}) (q10) and 90th (q90) percentile. The emergence and harvest detection algorithm use the q50 values for their predictions. The emergence or harvest uncertainty in days is based on the upper (q90) and lower (q10) confidence of fAPAR at the event (i.e., emergence or harvest) date and the slope of fAPAR at event date (denoted as slope <span class="math inline">\(fAPAR_{event q50}\)</span>) (see equation and Figure 24 below):</p>
<p><span class="math display">\[
fAPAR_{\mathrm{uncertainty}\;q10} = fAPAR_{\mathrm{event}\;q50} - fAPAR_{\mathrm{event}\;q10}
\]</span></p>
<p><span class="math display">\[
fAPAR_{\mathrm{uncertainty}\;q90} = fAPAR_{\mathrm{event}\;q50} - fAPAR_{\mathrm{event}\;q90}
\]</span></p>
<p><span class="math display">\[
days\;uncertainty_{\mathrm{event}} =
\mathrm{abs}\!\left(\frac{fAPAR_{\mathrm{uncertainty}\;q10}}
{slope\;fAPAR_{\mathrm{event}\;q50}}\right)
+
\mathrm{abs}\!\left(\frac{fAPAR_{\mathrm{uncertainty}\;q90}}
{slope\;fAPAR_{\mathrm{event}\;q50}}\right)
\]</span></p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-23efa437cf45423915c018c5bdcd16023b7c710b.png" class="img-fluid figure-img"></p>
<figcaption>Figure 24: Schematic overview on the parameters used to calculate the uncertainty at an event data (i.e., emergence or harvest). Event date is in this example, an emergence.</figcaption>
</figure>
</div>
<p>In rare cases, this approach does not yield reliable results, for example when the slope around emergence or harvest is nearly zero. In these cases, the uncertainty is calculated as follows.</p>
<ol type="1">
<li><p>In case of emergence, the uncertainty is the number of days after the event to reach the q50 fAPAR value at emergence by the q10 time series. For harvest, the uncertainty in days can be estimated by the number of days before the harvest event that the q10 time series reach the q50 fAPAR value at harvest.</p></li>
<li><p>In case of emergence, the uncertainty in days can be estimated by the number of days before the emergence event that the q90 time series reach the q50 fAPAR value at emergence. For harvest, the uncertainty is the number of days after the event to reach the q50 fAPAR value at harvest by the q90 time series.</p></li>
<li><p>The total uncertainty is then determined by summing up the number of days determined in (1) and (2).</p></li>
</ol>
<p>Note that, during cloudy periods, the confidence interval will increase as the uncertainty on the fAPAR will also increase.</p>
<p>For most <strong>CP</strong> layers the uncertainties correspond to the uncertainties that are derived from the emergence and harvest date of the specific season. And exception is the <strong>Fallow Land Presence Confidence Layer (CPFLPCL)</strong> which is based on the <strong>Crop Type Confidence Layer (CTYCL)</strong> (which is by default below 35 for fallow fields) and set to:</p>
<p><span class="math display">\[
\mathrm{CPFLPCL} = \frac{CTYCL - 10}{35 - 10} \cdot 100
\]</span></p>
<p>The lower the <strong>CTYCL</strong> of a fallow field the higher the <strong>CPFLPCL</strong>. In case the <strong>CTYCL</strong> is below 10, the confidence for fallow land presence is confined at 100.</p>
<p>The <strong>Fallow Land Duration Confidence Layer (FLDCL)</strong> can only be calculated when a harvest date is utilized to determine the start or end of a fallow land period. The uncertainty on the harvest date is used to provide information on the fallow land duration confidence. If there is no harvest event on the fallow field, a flag is assigned to the layer. Like for the <strong>FLDCL</strong> layer, the sum of the uncertainties (whenever present) is taken over the five-year period to determine the corresponding uncertainty.</p>
</section>
<section id="derivation-of-main-crops-bare-soil-secondary-crops-fallow-land-and-cropping-seasons-layers" class="level3" data-number="3.6.5">
<h3 data-number="3.6.5" class="anchored" data-anchor-id="derivation-of-main-crops-bare-soil-secondary-crops-fallow-land-and-cropping-seasons-layers"><span class="header-section-number">3.6.5</span> Derivation of Main Crops, Bare Soil, Secondary Crops, Fallow Land and Cropping Seasons layers</h3>
<p>Based on the delineation of the growing season and the uncertainty of the fAPAR the raster layers for the five layer groups Main Crops, Bare Soil, Secondary Crops, Fallow Land and Cropping Seasons can be derived. This section provides further details on how this has been implemented.</p>
<section id="main-crops" class="level4" data-number="3.6.5.1">
<h4 data-number="3.6.5.1" class="anchored" data-anchor-id="main-crops"><span class="header-section-number">3.6.5.1</span> Main Crops</h4>
<p>For all fields that do have a delineated main season and are not designated as fallow land (see section 3.6.5.4), the following layers based on the main seasonality are derived:</p>
<ul>
<li><p><strong>Main Crop Harvest (MCH) + Confidence Layer (MCHCL)</strong></p></li>
<li><p><strong>Main Crop Emergence (MCE) + Confidence Layer (MCECL)</strong></p></li>
<li><p><strong>Main Crop Duration (MCD) + Confidence Layer (MCDCL)</strong></p></li>
</ul>
<p>The first two layers are directly derived from the emergence and harvest information of the delineated season. The confidence is derived from the uncertainty on the emergence or harvest date. The <strong>Main Crop Duration</strong> is the difference in days between the emergence and harvest of the season. The confidence of the crop duration is the average of the confidence on the emergence and harvest date.</p>
</section>
<section id="bare-soil" class="level4" data-number="3.6.5.2">
<h4 data-number="3.6.5.2" class="anchored" data-anchor-id="bare-soil"><span class="header-section-number">3.6.5.2</span> Bare soil</h4>
<p>The <strong>Bare Soil (BS)</strong> layers define the number of days that a field is left bare before and after the main season. If no main season is detected for a specific field or the if the field is designated as fallow land (see section 3.6.5.4) no bare soil information is provided). The following two bare soil layers are produced:</p>
<ul>
<li><p><strong>Bare Soil Before</strong> main season <strong>(BSB) + Confidence Layer (BSBCL)</strong></p></li>
<li><p><strong>Bare Soil After</strong> main season <strong>(BSA) + Confidence Layer (BSACL)</strong></p></li>
</ul>
<p>The duration of the bare soil period following the main season is determined by calculating the number of days between the harvest of the main season and the subsequent emergence date. If there is no emergence date within the same reference year as the product, the bare soil period ends on the last day of the year. If the main season ends after the end of the reference year, no bare soil period after the main season is provided. Conversely, for the bare soil period preceding the main season, the days between the last harvest date prior to the main season and the emergence date are determined. If there is no preceding harvest date in the reference year, the bare soil period begins on the first day of the year. If the main season commences before the reference year, no bare soil period is considered, as it is only calculated for the year in which the layer is produced.</p>
<p>The confidence of the bare soil layer before and after the main season layers is determined by considering the uncertainty in the emergence or harvest dates that define the bare soil period. The average uncertainty in the emergence and/or harvest dates is used to calculate the uncertainty in the bare soil layers. If the bare soil period begins at the start of the reference year and does not align with a harvest event, only the uncertainty in the emergence of the main season start is considered for the calculation of the bare soil period before the main season. Conversely, if the bare soil period ends at the end of the reference year and does not align with an emergence event, only the uncertainty in the harvest event from the main season is considered for the calculation of the uncertainty in the bare soil period after the main season.</p>
</section>
<section id="secondary-crops" class="level4" data-number="3.6.5.3">
<h4 data-number="3.6.5.3" class="anchored" data-anchor-id="secondary-crops"><span class="header-section-number">3.6.5.3</span> Secondary Crops</h4>
<p>The <strong>Secondary Crop (SC)</strong> season typically occurs during the off-season period. Typical secondary crops are cover crops, which are directly planted after the main season. These crops are often used to enhance soil quality, prevent soil erosion, and provide various other beneficial effects (Fendrich et al., 2023). As a result, in the season delineation labeling (see section 3.6.3), priority was given to secondary seasons that occur after the main growing season. If only one secondary growing season is delineated that starts in winter or early spring within the reference year, that season will be classified as a secondary season. The following layers are available for secondary crops, only if the field has a main season and a secondary season and is not classified as fallow land (see section Fallow land):</p>
<ul>
<li><p><strong>Secondary Crops Type (SCT)</strong></p></li>
<li><p><strong>Secondary Crops Emergence (SCE)</strong></p></li>
<li><p><strong>Secondary Crops Duration (SCD) + Confidence Layer (SCDCL)</strong></p></li>
</ul>
<p>The first layer classifies the detected secondary crops into four categories:</p>
<ul>
<li><p><em>Short summer</em></p></li>
<li><p><em>Long summer</em></p></li>
<li><p><em>Short winter</em></p></li>
<li><p><em>Long winter</em></p></li>
</ul>
<p>The categorization of crops is determined by two parameters: the duration of the secondary season and the timing of its emergence. Through cluster analysis of these parameters, secondary crops can be classified into the described four categories. The distinction between short and long growing variants is based on the length of the season: if it is less than 100 days, it is considered short; otherwise, it is classified as long. Additionally, a secondary crop that emerges after the main growing season and before September is labeled as a summer variant, all other cases are classified as winter variants. Typically, a secondary crop season preceding the main season is categorized as a short growing winter variant.</p>
<p>The <strong>SCE</strong> layer can be directly derived from the emergence date of the delineated secondary crop season. The secondary crop season duration is calculated based on the difference in days between the harvest and emergence date. The confidence of the <strong>SCD</strong> is the average of the confidence on the emergence and harvest date.</p>
</section>
<section id="sec-Fallow-land" class="level4" data-number="3.6.5.4">
<h4 data-number="3.6.5.4" class="anchored" data-anchor-id="sec-Fallow-land"><span class="header-section-number">3.6.5.4</span> Fallow land</h4>
<p>Fallow land is defined as agricultural land where, temporarily, no agricultural activity takes place. The detection of fallow land is performed on a subset of the parcels used for the CP, i.e.&nbsp;only those fields where on average the CTY confidence within the field is below 35, are assessed.</p>
<p>Following layers are generated for fallow land:</p>
<p>➢ <strong>Fallow Land Presence (FLP) + Confidence Layer (FLPCL)</strong></p>
<p>➢ <strong>Fallow Land Duration (FLD) + Confidence Layer (FLDCL)</strong></p>
<p><strong><em>Fallow land presence classification method</em></strong></p>
<p>The workflow applied to determine fallow land presence is shown in Figure 25. After the selection of parcels with an average annual crop type confidence below 35, the number and sequence of detected harvests and emergences in combination with the maximum fAPAR value are evaluated. The evaluation of this parameters is solely done within the reference year. When a harvest event is detected on a field it is evaluated if it occurs before a zone-specific allowed harvest date. This zonation aligns with the two zones used for the season delineation (see section Growing season delineation). The allowed harvest date is set before April 1st for fields located in zone 2 (see Table 5) and before May 1st for fields located in zone 1. If the harvest falls earlier, then this allowed harvest date is likely the harvest of the previous year sown secondary crop. In total 8 cases were defined to which the selected parcels could be classified as fallow land, as described below:</p>
<p><strong>No emergence no harvest:</strong> There is no harvest nor emergence detected on the field. These are fields where there is clearly no agricultural activity, and they can thus be considered as fallow.</p>
<p><strong>Harvest:</strong> There is only one harvest event detected on the field and it occurs before the allowed harvest date. Since there is only one harvest that can be associated with a previous year secondary crop and no emergences or harvests are detected after the allowed harvest date the field is considered as fallow.</p>
<p><strong>Emergence:</strong> There is only one emergence detected on the field, since there is no harvest detected on the field, the emergence can be associated to fallow vegetation emerging on the field.</p>
<p><strong>Harvest-Emergence:</strong> One harvest date is detected before the allowed harvest date followed by an emergence. The harvest can be associated with a previous year secondary crop and the emergence can be associated to fallow vegetation emerging on the field.</p>
<p><strong>Emergence-Harvest:</strong> An emergence is followed by a harvest event and the length between these two events is at least 252 days (i.e., 9 months). The emergence can be associated with fallow vegetation emerging on the field, a harvest after 9 months is allowed since fallow vegetation can die back in winter period which can be falsely detected as a harvest.</p>
<p><strong>Harvest-Harvest:</strong> There are two harvests detected on the field before the allowed harvest date and the maximum fAPAR after the second harvest is below 0.35. In this case the harvest can be associated with a previous year secondary crop followed by a period of bare soil/very sparse fallow vegetation growth, the field is therefore considered as fallow.</p>
<p><strong>Harvest-Harvest-Emergence:</strong> In the case two harvest events follow each other closely (i.e., they are less than or equal to sixty days apart) and an emergence follows these harvests. In this case the harvests can be associated with a previous year secondary crop followed by a period of fallow vegetation emergence, the field is therefore considered as fallow.</p>
<p><strong>Emergence-Emergence:</strong> There are two emergences detected on the field but the maximum fAPAR value stays below 0.35. These fields have bare soil/very sparse fallow vegetation growth and are therefore considered as fallow.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-2e78c63221247c54d2de67164438c015ea8c8e30.png" class="img-fluid figure-img"></p>
<figcaption>Figure 25: Workflow for fallow land presence classification. With CP: cropping pattern, CTYCL: confidence value of CTY layer. For the Metzger based environmental zonation see Table 5.</figcaption>
</figure>
</div>
<p>For details on the calculation of the <strong>Fallow Land Presence Confidence Layer (FLPCL)</strong> please refer to section</p>
<p><strong><em>Fallow duration</em></strong></p>
<p>The <strong>Fallow Land Duration (FLD)</strong> layer is defined as the sum of the yearly <strong>FLD</strong> over the last fiveyears period. The yearly fallow land duration is calculated as follows:</p>
<p>➢ If a harvest date determines the start of the fallow land period, the length starts at that date until the end of the year.</p>
<p>➢ If the harvest defines the end of the fallow land period, the length starts at the first day of the year until the harvest date.</p>
<p>➢ If there is no harvest detected, the length is set to 365 days.</p>
</section>
<section id="cropping-seasons" class="level4" data-number="3.6.5.5">
<h4 data-number="3.6.5.5" class="anchored" data-anchor-id="cropping-seasons"><span class="header-section-number">3.6.5.5</span> Cropping Seasons</h4>
<p>The <strong>Cropping Seasons (CL)</strong> layers provide some information on the crop type rotation over a three-year period or within a single reference year and consist of the following two layers:</p>
<ul>
<li><p><strong>Cropping Seasons Yearly (CSY)</strong></p></li>
<li><p><strong>Cropping Season Types over three years (CST)</strong></p></li>
</ul>
<p>The <strong>CSY</strong> layer establishes the number of growing seasons in one year (max. 2) for each selected field used in <strong>CP</strong> layers generation (only annual crops) and excluding fallow land. If both a secondary season and an annual crop type are identified, it will be counted as two growing seasons. If no secondary season falls within the seasonal limits, but it is classified as an annual crop type, it will be counted as one growing season for that year. In all other scenarios, it will be classified as having no cropping season within the reference year.</p>
<p>The <strong>CST</strong> layer is solely based on the <strong>CTY</strong> layer and only considers the annual crop type labels for counting crop rotation. For each reference period of three years, this layer is generated by considering the two years prior to the end of the reference period. As a consequence, the layer is only available from the reference period P2017-2019 onward. During any three-year reference period, the number of unique crop type labels is counted and can range from 1 to 3. Permanent crop labels are not included in the count, and if all three years consist of permanent crops, a value of zero will be assigned. There is one exception to the counting of crop type labels:</p>
<p>If the unclassified arable crop land label appears in any of the three years, it will be excluded from the count to avoid the risk of double counting the same crop type. If the entire period is classified as unclassified arable crop land, the count will be set to one.</p>
</section>
<section id="encountered-issues-and-known-limitations-2" class="level4" data-number="3.6.5.6">
<h4 data-number="3.6.5.6" class="anchored" data-anchor-id="encountered-issues-and-known-limitations-2"><span class="header-section-number">3.6.5.6</span> Encountered issues and known limitations</h4>
<p>A limitation of the <strong>Fallow Land (FL)</strong> layers is that only a subset of fields is considered for fallow land evaluation. Therefore, fallow fields that are not covered by the annual crop type masked parcel delineation product will not be examined and therefore not detected. Furthermore, reference data on fallow land is scarce and often a harmonized definition of fallow land is absent, which makes it hard to evaluate the product. Therefore, it was decided to work with some thematic rules that fit with the expected behavior of fallow land.</p>
<p>The expert rules are defined to determine crop seasonality (section <a href="#sec-Season-delineation" class="quarto-xref">Section&nbsp;3.6.3.3</a>) for most cases. However, there are still some specific cases that may not be addressed by the seasonal limits defined by the set of expert rules. In such cases, additional checks are needed to determine if the detected seasonality should be included in the <strong>CP</strong> layers. Some of these cases are discussed below.</p>
<p>In the case where a season does not correspond with any main season in the reference year, it is verified if there is still a season onset after the anticipated period of emergence for spring crops and a harvest event before the conclusion of the reference year. By applying this rule, the seasonality of vegetables that are planted late in the season are included. However, most of these cases involve fallow land with minimal seasonality and are categorized under fallow land layers (see section <a href="#sec-Fallow-land" class="quarto-xref">Section&nbsp;3.6.5.4</a>).</p>
<p>In the case where multiple spring crops are cultivated on a field, the first detected season is considered as the main season and the second one as the secondary season. In the case two secondary crop seasons occur after the main season, the first one is selected as secondary season. Other exceptions can occur but are not described due to their rare occurrence.</p>
<p>Overall, the applied expert rules cover the most common seasonalities of annual crops, but some limitations exist. For example, in case of too short growing season lengths, some vegetables could be excluded from <strong>CP</strong> layers generation. However, shortening the allowed seasonal length would include much more expectations in the <strong>CP</strong> layers, leading to a less reliable product. Moreover, that the shorter the season the more errors could occur in the emergence and harvest detection, resulting in errors in the seasonal delineation.</p>
<p>In the case of double cropping seasons, there are instances where the seasonal labelling conflicts with the crop type label in the <strong>CTY</strong> layer. For instance, if a winter cereal is followed by maize, the <strong>CTY</strong> label might classify it as maize, while the season delineation designates the winter cereal season as the main season. This situation is more likely to occur in the southern regions of Europe where the climate allows for double cropping. In these areas, it is also possible for the harvest of winter cereals to coincide with the secondary crop harvest. In such cases, it becomes challenging to differentiate between winter cereals and secondary crops, leading to the possibility of the secondary crop being considered the main season. However, if a spring main crop signal is detected subsequently, it will be recognized as the main season.</p>
<p>In addition to the challenges associated with labeling seasons, issues may arise from the emergence and harvest detection processes themselves. For some specific crops like sunflowers, it is observed that often the seasonal signal is too subtle (Figure 26) to allow any harvest detection. This limitation has been particularly noted during the growing season of 2019 in southern Spain. No training data on this specific crop in this area is available to be able to improve the harvest detection algorithm.</p>
<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="HRL_VLCC_ATBD_v2.1-media/img-a014c53b4082d3774a361ab4665f133ec588819a.png" class="img-fluid figure-img"></p>
<figcaption>Figure 26: Example of CropSAR fAPAR signal for a sunflower field in southern Spain in 2019. The black lines show the detected emergence dates within the time series.</figcaption>
</figure>
</div>
<p>Additionally, in certain scenarios, consecutive emergence events without a corresponding harvest event in between, or vice versa occur. To address these situations, additional rules based on a bare soil indicator are developed to be able to select the correct emergence or harvest dates for linking seasons. However, some cases may still lead to the selection of incorrect emergence or harvest dates, resulting in outliers in seasonal length (either too short or excessively long) or even seasons that fall outside the allowed season boundaries. This issue is particularly prevalent when a secondary crop is planted immediately after the main crops harvest, or when the delineated parcel is a multi-cropped field, leading to emergence/harvest signals that reflect this multi-cropping behavior. Furthermore, in northern regions of Europe where a permanent snow cover occurs before main crops are harvested, the harvest may not be accurately detected, in these cases it impossible to identify any season even when crop cultivation does occur.</p>
<p>Finally, some limitations in the <strong>CP</strong> layers arise from the filtering of annual crops based on the <strong>HRL CTY</strong> classification. Specifically, if a field is delineated but not classified as annual cropland in the <strong>CTY</strong> layer, no <strong>CP</strong> information is generated for that field—even in cases where annual cropping activity may actually be present. Conversely, false positives in the <strong>CTY</strong> annual crop classification can introduce artefacts into the <strong>CP</strong> layers by triggering extraction where no actual annual crop exists.</p>
<p>On the other hand, some annual cropland pixels in the <strong>CTY</strong> layer lack corresponding field delineations, resulting in missing <strong>CP</strong> outputs. At the Pan-European scale, approximately 10% of pixels classified as annual crops do not intersect with any delineated field and therefore cannot be assigned <strong>CP</strong> information. This loss is primarily due to two factors:</p>
<ul>
<li><p>5% is due to pixel-level misalignment at field boundaries, regions with more small and elongated fields will have more data loss.</p></li>
<li><p>The remaining 5% stems from larger spatial mismatches between the extent of <strong>CTY</strong> classified annual crop areas and the delineated field geometries. These discrepancies are most pronounced for crop types with lower classification accuracy—such as fresh vegetables, other cereals, and unclassified arable crops.</p></li>
</ul>
<p>In contrast, for other (and most common) annual crop classes, around 95% of pixels are successfully aligned with the delineated field boundaries, ensuring reliable <strong>CP</strong> generation for these key crop types. For these crop types, the pixel misalignment at the field border is the main reason for this 5% loss of <strong>CP</strong> output.</p>
<div style="page-break-after: always;"></div>
</section>
</section>
</section>
</section>
<section id="list-of-abbreviations" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> List of abbreviations</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th>Abbreviation</th>
<th>Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>ADs</td>
<td>Applicable Documents</td>
</tr>
<tr class="even">
<td>AOI</td>
<td>Area of Interest</td>
</tr>
<tr class="odd">
<td>BCD</td>
<td>Broadleaved Cover Density</td>
</tr>
<tr class="even">
<td>BVL</td>
<td>Base Vegetation Layer</td>
</tr>
<tr class="odd">
<td>CAP</td>
<td>Common Agricultural Policy of the European Union</td>
</tr>
<tr class="even">
<td>CCD</td>
<td>Coniferous Cover Density</td>
</tr>
<tr class="odd">
<td>CDD</td>
<td>Crop Diversity and Diversification</td>
</tr>
<tr class="even">
<td>CL</td>
<td>Confidence Layer</td>
</tr>
<tr class="odd">
<td>CLC</td>
<td>CORINE Land Cover</td>
</tr>
<tr class="even">
<td>CLC+</td>
<td>CORINE Land Cover +</td>
</tr>
<tr class="odd">
<td>CLMS</td>
<td>Copernicus Land Monitoring Service</td>
</tr>
<tr class="even">
<td>CORINE</td>
<td>Coordination of information on the environment</td>
</tr>
<tr class="odd">
<td>CROP</td>
<td>Cropland Products</td>
</tr>
<tr class="even">
<td>CT</td>
<td>Crop Type Layer</td>
</tr>
<tr class="odd">
<td>CTY</td>
<td>Crop Types</td>
</tr>
<tr class="even">
<td>CTYCL</td>
<td>Crop Types Confidence Layer</td>
</tr>
<tr class="odd">
<td>DEM</td>
<td>Digital Elevation Model</td>
</tr>
<tr class="even">
<td>DIAS</td>
<td>Copernicus Data and Information Access Services</td>
</tr>
<tr class="odd">
<td>DLT</td>
<td>Dominant Leaf Type</td>
</tr>
<tr class="even">
<td>DLTC</td>
<td>Dominant Leaf Type Change</td>
</tr>
<tr class="odd">
<td>DLTCL</td>
<td>Dominant Leaf Type Change</td>
</tr>
<tr class="even">
<td>DTW</td>
<td>Dynamic Time Warp</td>
</tr>
<tr class="odd">
<td>EEA</td>
<td>European Environment Agency</td>
</tr>
<tr class="even">
<td>EEA38</td>
<td>The 32 member and 6 cooperating countries of the EEA</td>
</tr>
<tr class="odd">
<td>EO</td>
<td>Earth Observation</td>
</tr>
<tr class="even">
<td>EPSG</td>
<td>European Petroleum Survey Group</td>
</tr>
<tr class="odd">
<td>ESYRCE</td>
<td>Encuesta sobre Superficies y Rendimientos Cultivos</td>
</tr>
<tr class="even">
<td>ETC</td>
<td>European Topic Centre</td>
</tr>
<tr class="odd">
<td>EU</td>
<td>European Union</td>
</tr>
<tr class="even">
<td>EU27</td>
<td>The 27 member states of the EU</td>
</tr>
<tr class="odd">
<td>EVI</td>
<td>Enhanced Vegetation Index</td>
</tr>
<tr class="even">
<td>FADSL</td>
<td>Forest Additional Support Layer</td>
</tr>
<tr class="odd">
<td>fAPAR</td>
<td>fraction of Absorbed Photosynthetic Active Radiation</td>
</tr>
<tr class="even">
<td>FL</td>
<td>Fallow Land</td>
</tr>
<tr class="odd">
<td>Fmask</td>
<td>Function of mask</td>
</tr>
<tr class="even">
<td>FOR</td>
<td>Forest Products</td>
</tr>
<tr class="odd">
<td>FWC</td>
<td>Framework Contract</td>
</tr>
<tr class="even">
<td>F-Score</td>
<td>Harmonic mean of the Producer’s and the User’s Accuracies</td>
</tr>
<tr class="odd">
<td>FTY</td>
<td>Forest Type</td>
</tr>
<tr class="even">
<td>GDAL</td>
<td>Geospatial Data Abstraction Library</td>
</tr>
<tr class="odd">
<td>GRA</td>
<td>Grassland Status Layer</td>
</tr>
<tr class="even">
<td>GRAC</td>
<td>Grassland Change Layer</td>
</tr>
<tr class="odd">
<td>GRACL</td>
<td>Grassland Confidence Layer</td>
</tr>
<tr class="even">
<td>GRACCL</td>
<td>Grassland Change Confidence Layer</td>
</tr>
<tr class="odd">
<td>GRAM</td>
<td>Grassland Mowing Events</td>
</tr>
<tr class="even">
<td>GRAMCL</td>
<td>Grassland Mowing Confidence Layer</td>
</tr>
<tr class="odd">
<td>GRAMD</td>
<td>Grassland Mowing Dates</td>
</tr>
<tr class="even">
<td>GRAME</td>
<td>Grassland Mowing Events</td>
</tr>
<tr class="odd">
<td>HBS</td>
<td>Harvest and Bare Soil</td>
</tr>
<tr class="even">
<td>HER</td>
<td>Herbaceous Cover Layer</td>
</tr>
<tr class="odd">
<td>HR</td>
<td>High Resolution</td>
</tr>
<tr class="even">
<td>HRL / HRLs</td>
<td>High Resolution Layer / High Resolution Layers</td>
</tr>
<tr class="odd">
<td>HRL VLCC</td>
<td>High Resolution Layer – Vegetated Land Cover Characteristics</td>
</tr>
<tr class="even">
<td>ID</td>
<td>Identification Number</td>
</tr>
<tr class="odd">
<td>JRC</td>
<td>Joint Research Centre</td>
</tr>
<tr class="even">
<td>KOM</td>
<td>Kick-Off Meeting</td>
</tr>
<tr class="odd">
<td>L2A</td>
<td>Level 2A</td>
</tr>
<tr class="even">
<td>LAEA</td>
<td>Lambert Azimuthal Equal Area projection</td>
</tr>
<tr class="odd">
<td>LAI</td>
<td>Leaf Area Index</td>
</tr>
<tr class="even">
<td>LC</td>
<td>Land Cover</td>
</tr>
<tr class="odd">
<td>LiDAR</td>
<td>Light Detection and ranging</td>
</tr>
<tr class="even">
<td>LPIS</td>
<td>Land-Parcel Identification System</td>
</tr>
<tr class="odd">
<td>LU</td>
<td>Land Use</td>
</tr>
<tr class="even">
<td>LUCAS</td>
<td>Land Use/ Cover Area frame Survey</td>
</tr>
<tr class="odd">
<td>LULUCF</td>
<td>Land Use, Land Use Change and Forestry</td>
</tr>
<tr class="even">
<td>MMU</td>
<td>Minimum Mapping Unit</td>
</tr>
<tr class="odd">
<td>NDVI</td>
<td>Normalised Difference Vegetation Index</td>
</tr>
<tr class="even">
<td>NBR2</td>
<td>Normalized Burnt Ratio 2</td>
</tr>
<tr class="odd">
<td>OA</td>
<td>Overall Accuracy</td>
</tr>
<tr class="even">
<td>OpenEO</td>
<td>API to connect different programming languages to EO cloud back-ends</td>
</tr>
<tr class="odd">
<td>PA</td>
<td>Producer Accuracy</td>
</tr>
<tr class="even">
<td>PLOUGH</td>
<td>Ploughing Indicator</td>
</tr>
<tr class="odd">
<td>PPT</td>
<td>PowerPoint Presentation</td>
</tr>
<tr class="even">
<td>PU</td>
<td>Production Unit</td>
</tr>
<tr class="odd">
<td>Rr</td>
<td>Recognition Rate</td>
</tr>
<tr class="even">
<td>SAR</td>
<td>Synthetic Aperture Radar</td>
</tr>
<tr class="odd">
<td>SC</td>
<td>Specific Contract</td>
</tr>
<tr class="even">
<td>SCL</td>
<td>Scene Classification Layer</td>
</tr>
<tr class="odd">
<td>Sen2Cor</td>
<td>Processor for Sentinel-2 Level 2A product generation</td>
</tr>
<tr class="even">
<td>SIGPAC</td>
<td>Sistema de Información Geográfica de Parcelas Agrícolas</td>
</tr>
<tr class="odd">
<td>TBD</td>
<td>To Be Discussed / Defined</td>
</tr>
<tr class="even">
<td>TCD</td>
<td>Tree Cover Density</td>
</tr>
<tr class="odd">
<td>TCCM</td>
<td>Tree Cover Change Mask</td>
</tr>
<tr class="even">
<td>TCDCL</td>
<td>Tree Cover Density Confidence Layer</td>
</tr>
<tr class="odd">
<td>TCPC</td>
<td>Tree Cover Presence Change</td>
</tr>
<tr class="even">
<td>TCPCCL</td>
<td>Tree Cover Presence Change Confidence Layer</td>
</tr>
<tr class="odd">
<td>TempCNN</td>
<td>Temporal Convolutional Neural Network</td>
</tr>
<tr class="even">
<td>UA</td>
<td>User’s Accuracies</td>
</tr>
<tr class="odd">
<td>USDA</td>
<td>United States Department of Agriculture</td>
</tr>
<tr class="even">
<td>UTM</td>
<td>Universal Transverse Mercator</td>
</tr>
<tr class="odd">
<td>VHR</td>
<td>Very High Resolution</td>
</tr>
<tr class="even">
<td>VPP PPI</td>
<td>Vegetation Phenology and Productivity parameters – Plant Phenology Index</td>
</tr>
<tr class="odd">
<td>XML</td>
<td>Extensible Markup Language</td>
</tr>
<tr class="even">
<td>WEkEO</td>
<td>Copernicus DIAS reference service for environmental data, virtual environments for data processing</td>
</tr>
</tbody>
</table>
<div style="page-break-after: always;"></div>
</section>
<section id="references" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> References</h1>
<ul>
<li><p>Alcaras, E., Costantino, D., Guastaferro, F., Parente, C. &amp; Pepe, M. Normalized Burn Ratio Plus (NBR+): A New Index for Sentinel-2 Imagery. remote sensing, vol.&nbsp;14, no. 7, pp.&nbsp;1-19, 2022.</p></li>
<li><p>Aybar, C., Ysuhuaylas, L., Loja, J., Gonzales, K., Herrera, F., Bautista, L., … &amp; GómezChova, L. (2022). CloudSEN12, a global dataset for semantic understanding of cloud and cloud shadow in Sentinel-2. Scientific Data, 9(1), 782.</p></li>
<li><p>Coltuc, D., Bolon, P., &amp; Chassery, J. M. (2006). Exact histogram specification. IEEE Transactions on Image Processing, 15(5), 1143-1152.</p></li>
<li><p>“CropSAR service,” VITO, [Online]. Available: https://cropsar.vito.be/api/docs/.[Accessed 24 07 2024].</p></li>
<li><p>De Vroey, M., Radoux, J., &amp; Defourny, P. (2021). Grassland mowing detection using sentinel-1 time series: potential and limitations. Remote Sensing, 13(3), 348.</p></li>
<li><p>Dorogush, A. V., Ershov, V., &amp; Gulin, A. (2018). CatBoost: gradient boosting with categorical features support. arXiv preprint arXiv:1810.11363.</p></li>
<li><p>EEA (2023). EEA38 10m Boundary Layer https://sdi.eea.europa.eu/webdav/datastore/public/eea_r_3035_10_m_copernicus-250m-buffer_p_2012-2018_v02_r00/GTIFF/Boundary_EEA38_03035_010m_v02.tif</p></li>
<li><p>Eurostat. (2018). LUCAS Survey 2018. [Data set]. https://ec.europa.eu/eurostat/web/lucas/data/primary-data.</p></li>
<li><p>FAO. (2012). Terms and Definitions: FRA 2015. Forest Resources Assessment Working Paper 180. Food and Agriculture Organization of the United Nations, Rome.</p></li>
<li><p>Fendrich, A. N., Matthews, F., Van Eynde, E., Carozzi, M., Li, Z., d’Andrimont, R., Lugato, E., Martin, P., Ciais, P., &amp; Panagos, P. (2023). From regional to parcel scale: A highresolution map of cover crops across Europe combining satellite data with statistical surveys. In Science of The Total Environment (Vol. 873, p.&nbsp;162300). Elsevier BV. https://doi.org/10.1016/j.scitotenv.2023.162300</p></li>
<li><p>Gao, F., Anderson, M., Johnson, D., Seffrin, R., Wardlow, B., Suyker, A., Dia, C. &amp; Browning, D. Towards Routine Mapping of Crop Emergence within the Season Using the Harmonized Landsat and Sentinel-2 Dataset. Remote Sensing, vol.&nbsp;13, no. 24:5074, 2021.</p></li>
<li><p>Gao, F., Anderson, M., Zhang, X., Yang, Z., Alfieri, J., Kustas, W., Mueller, R., Johnson, D. &amp; Prueger, J. Toward mapping crop progress at field scales through fusion of Landsat and MODIS imagery. Remote Sensing of Environment, vol.&nbsp;188, pp.&nbsp;9-25, 2017.</p></li>
<li><p>Garioud, A., Giordano, S., Valero, S., &amp; Mallet, C. (2019, August). Challenges in grassland mowing event detection with multimodal sentinel images. In 2019 10th International Workshop on the Analysis of Multitemporal Remote Sensing Images (MultiTemp) (pp.&nbsp;1-4). IEEE.</p></li>
<li><p>Griffiths, P., Nendel, C., Pickert, J., &amp; Hostert, P. (2020). Towards national-scale characterization of grassland use intensity from integrated Sentinel-2 and Landsat time series. Remote Sensing of Environment, 238, 111124.</p></li>
<li><p>Hardy, T., Kooistra, L., Domingues Franceschini, M., Richter, S., Vonk, E., van den Eertwegh, G., &amp; Van Deijl, D. (2021). Sen2Grass: A cloud-based solution to generate field-specific grassland information derived from Sentinel-2 imagery. AgriEngineering, 3(1), 118-137.</p></li>
<li><p>Khabbazan, S., Vermunt, P., Steele-Dunne, S., Arntz, L., Marinetti, C., Van der Valk, D., Iannini, L., Molijn, R., Westerdijk, K. &amp; Van der Sande, C. Crop Monitoring Using Sentinel-1 Data: A Case Study from The Netherlands. Remote Sensing, vol.&nbsp;11, no. 16:1887, 2019.</p></li>
<li><p>Kolecka, N., Ginzler, C., Pazur, R., Price, B., &amp; Verburg, P. H. (2018). Regional scale mapping of grassland mowing frequency with sentinel-2 time series. Remote Sensing, 10(8), 1221.</p></li>
<li><p>Malinin, A., Prokhorenkova, L., &amp; Ustimenko, A. (2020). Uncertainty in gradient boosting via ensembles. arXiv preprint arXiv:2006.10562.</p></li>
<li><p>Meroni, M., D’andrimont, R., Vrieling, A., Fasbender, D., Lemoine, G., Rembold, F., Seguini, L. &amp; Verhegghen, A. Comparing land surface phenology of major European crops as derived from SAR and multispectral data of Sentinel-1 and -2. Remote Sensing of Environment, vol.&nbsp;253, no. 112232, 2021.</p></li>
<li><p>Metzger M.J., Bunce R.G.H., Jongman R.H.G., Sayre R., Trabucco A., Zomer R., Sykes M. (2013). A high-resolution bioclimate map of the world: a unifying framework for global biodiversity research and monitoring. Glob. Ecol. Biogeogr., 22 (5), 630-638.</p></li>
<li><p>Metzger, M. J. (2018). The Environmental Stratification of Europe [Dataset]. University of Edinburgh. https://doi.org/10.7488/DS/2356.</p></li>
<li><p>Northcutt C., Athalye A., Mueller J. (2021). Pervasive Label Errors in Test Sets Destabilize Machine Learning Benchmarks. Proceedings of the Neural Information Processing Systems Track on Datasets and Benchmarks, 1.</p></li>
<li><p>Pelletier, C., Webb, G. I., &amp; Petitjean, F. (2019). Temporal convolutional neural network for the classification of satellite image time series. Remote Sensing, 11(5), 523.</p></li>
<li><p>Piccard, I., Gobin, A., Gilliams, S., Tits, L. &amp; Decloedt, J. WatchITgrow. Precision Agriculture: Modelling, Springer, 2023, pp.&nbsp;229-238.</p></li>
<li><p>Reinermann, S., Asam, S., &amp; Kuenzer, C. (2020). Remote sensing of grassland production and management—A review. Remote Sensing, 12(12), 1949.</p></li>
<li><p>Reinermann, S., Gessner, U., Asam, S., Ullmann, T., Schucknecht, A., &amp; Kuenzer, C. (2022). Detection of Grassland Mowing Events for Germany by Combining Sentinel-1 and Sentinel-2 Time Series. Remote Sensing, 14(7), 1647.</p></li>
<li><p>Salvador, S., &amp; Chan, P. (2007). Toward accurate dynamic time warping in linear time and space. Intelligent Data Analysis, 11(5), 561-580.</p></li>
<li><p>Schindler, K. (2012). An overview and comparison of smooth labeling methods for landcover classification. IEEE transactions on geoscience and remote sensing, 50(11), 4534-4545.</p></li>
<li><p>Siegmund, R., Redl, S., Wagner, M., &amp; Hartmann, S. (2019, October). Grassland monitoring based on Sentinel-1. In Remote Sensing for Agriculture, Ecosystems, and Hydrology XXI (Vol. 11149, p.&nbsp;1114902). SPIE.</p></li>
<li><p>Stendardi, L., Karlsen, S. R., Niedrist, G., Gerdol, R., Zebisch, M., Rossi, M., &amp; Notarnicola, C. (2019). Exploiting time series of Sentinel-1 and Sentinel-2 imagery to detect meadow phenology in mountain regions. Remote Sensing, 11(5), 542.</p></li>
<li><p>Tamm, T., Zalite, K., Voormansik, K., &amp; Talgre, L. (2016). Relating Sentinel-1 interferometric coherence to mowing events on grasslands. Remote Sensing, 8(10), 802.</p></li>
<li><p>Van Tricht, K, Gobin, A., Gilliams, S. &amp; Piccard, I. Synergistic Use of Radar Sentinel-1 and Optical Sentinel-2 Imagery for Crop Mapping: A Case Study for Belgium. Remote Sensing, vol.&nbsp;10, no. 10:1642, 2018.</p></li>
<li><p>Vaswani, A., Shazeer, N., Parmar, N., Uszkoreit, J., Jones, L., Gomez, A. N., … &amp; Polosukhin, I. (2017). Attention is all you need. Advances in neural information processing systems, 30.</p></li>
<li><p>Zerveas, G., Jayaraman, S., Patel, D., Bhamidipaty, A., &amp; Eickhoff, C. (2021, August). A transformer-based framework for multivariate time series representation learning. In Proceedings of the 27th ACM SIGKDD Conference on Knowledge Discovery &amp; Data Mining (pp.&nbsp;2114-2124). </p><div style="page-break-after: always;"></div><p></p></li>
</ul>
</section>
<section id="annex-i---aggregation-rules-for-20m-layers-tcpc-dltc-and-grac" class="level1" data-number="6">
<h1 data-number="6"><span class="header-section-number">6</span> Annex I - Aggregation rules for 20m layers TCPC, DLTC and GRAC</h1>
<p><img src="HRL_VLCC_ATBD_v2.1-media/img1.png" class="img-fluid"></p>
<p><img src="HRL_VLCC_ATBD_v2.1-media/img2.png" class="img-fluid"></p>
<p><img src="HRL_VLCC_ATBD_v2.1-media/img3.png" class="img-fluid"> </p><div style="page-break-after: always;"></div><p></p>
</section>
<section id="annex-ii-tcpc-mmu-filtering" class="level1" data-number="7">
<h1 data-number="7"><span class="header-section-number">7</span> Annex II TCPC MMU filtering</h1>
<p>The Tree Cover Presence Change is defined with a Minimum Mapping Unit (MMU) of 1 ha. The implementation of an MMU requires several choices and steps which are documented here. The detected gains and losses are initially aggregated to 20m according to the rules defined in Annex II. Holes smaller than the MMU and completely surrounded by either loss or gain are filled according to majority of their surroundings, in situation where no majority can be found the tree cover loss class dominates. Change patches smaller than the MMU are removed in such a way that tree cover gains are recoded as class 10 (unchanged areas with tree cover) and tree cover losses are recoded as class 0 (unchanged areas without tree cover).</p>
<p><img src="HRL_VLCC_ATBD_v2.1-media/img4.png" class="img-fluid"></p>
<p><img src="HRL_VLCC_ATBD_v2.1-media/img5.png" class="img-fluid"></p>


</section>


<a onclick="window.scrollTo(0, 0); return false;" role="button" id="quarto-back-to-top"><i class="bi bi-arrow-up"></i> Back to top</a><div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>https://gdal.org/en/stable/api/gdal_alg.html#_CPPv415GDALSieveFilter15GDALRasterBandH15GDALRasterBandH15GDALRasterBandHiiPPc16GDALProgressFuncPv<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>https://gdal.org/en/stable/api/gdal_alg.html#_CPPv414GDALFillNodata15GDALRasterBandH15GDALRasterBandHdiiPPc16GDALProgressFuncPv<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>https://land.copernicus.eu/en/products/corine-land-cover/clc2018<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>https://land.copernicus.eu/en/products/high-resolution-layer-grasslands/grassland-2018-raster-10-m-100-m-europe-yearly<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn5"><p>https://land.copernicus.eu/en/products/high-resolution-layer-grasslands/grassland-2018-raster-10-m-100-m-europe-yearly<a href="#fnref5" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn6"><p>https://land.copernicus.eu/en/products/vegetation<a href="#fnref6" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn7"><p>https://land.copernicus.eu/en/products/vegetation<a href="#fnref7" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn8"><p>https://land.copernicus.eu/en/products/vegetation<a href="#fnref8" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn9"><p>https://land.copernicus.eu/en/technical-library/hrl-grassland-2018-product-user-manual<a href="#fnref9" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn10"><p>https://gdal.org/en/stable/api/gdal_alg.html#_CPPv415GDALSieveFilter15GDALRasterBandH15GDALRasterBandH15GDALRasterBandHiiPPc16GDALProgressFuncPv<a href="#fnref10" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn11"><p>https://openeo.org/<a href="#fnref11" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section><section class="quarto-appendix-contents" id="quarto-reuse"><h2 class="anchored quarto-appendix-heading">Reuse</h2><div class="quarto-appendix-contents"><div>EUPL (&gt;= 1.2)</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp("https:\/\/eea\.github\.io\/CLMS_documents\/main");
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
    <div class="nav-footer-left">
<p>© 2025 EEA. All rights reserved.</p>
</div>   
    <div class="nav-footer-center">
      &nbsp;
    </div>
    <div class="nav-footer-right">
      &nbsp;
    </div>
  </div>
</footer>




</body></html>